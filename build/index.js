!function(r){var n={};function a(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=r,a.c=n,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(r,n,function(e){return t[e]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="build/",a(a.s=0)}({"./firebase_key.json":
/*!***************************!*\
  !*** ./firebase_key.json ***!
  \***************************/
/*! exports provided: type, project_id, private_key_id, private_key, client_email, client_id, auth_uri, token_uri, auth_provider_x509_cert_url, client_x509_cert_url, default */function(e){e.exports=JSON.parse('{"type":"service_account","project_id":"eventree-chat","private_key_id":"f61fa0333f03c536d8d992358cef6ad551821b02","private_key":"-----BEGIN PRIVATE KEY-----\\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC7DrbmaWo5iS8Q\\nspkA55FB0f7TBIRaVa2jQyjUqXOQg92ANNr1geZw7tTpDQzgrEmD+j/KGOXm+Y4p\\nmQRsHVB7cxztg/eGNIay7NbGJQwoMWfavUK5xGIK1Ao1guALgPiQLLklVB0SjUai\\nSqLPooU4rNZo6FB9w8opoi3EOPkI2lvba14l+chSwnvCZcNP6HP7EX95TYUhP38B\\nolbOzu52Y4tMOT+QyoNoO0H1bKacSOKMZmKdsQJFOZBcDHlFxNALSTHEh43bNq1u\\nfl2FDxU6IfUm4DYQq7O7WwoS/CIXKA/JGFKV/eB7xzmVC/wdBwbUwg5UmqgmdxHL\\n9vpG3/0NAgMBAAECggEAAS3Xi7gRROaJGgvSw7nKj1qX/MdA4D3kqtsvkumW6JqA\\nLoWQnWAMy/ncfkel3/9cyLpa/gB9IvTAKeadV+zir4r7MNU7ShdoA5EiCHBIEvhm\\nI1wLKFcbV8rItrCYv29alW8kRbJxqwHnJ91N13SiAhJPwIS5louBy9lFQYrcULAh\\n/BSlQS47McKFFFMOXdGv79Z2A1oY/nO+8xX6cnjwayUrXZNG/zbzqZZd9TaSs91G\\n26bMGcwfzippqMZhFLLcz2fH2HojqxgCDP2rNCPPzWDBDA2O/azDZJ1JHwM89DfG\\n63y15+Tpf7wHGnBu7UTINqj4hfv2Ds8KilR5Tz7xsQKBgQDinvQtdDVqBDNPiFfN\\nswT55utmkLewX+Z2TSvOyIi01k6KH0L/te0blsZOuNLKEI34XVzCGq2E9KInH61o\\nTKJ047rZnGVQ+/7H71XDtSl/LdBbJ7EjOcILwfoNtrNWikeJDVUHs7q1RIaObHTa\\nYLlTvUXtsbjz8e9j24TjvUuQvQKBgQDTTrzj+13P8iMoINkzk+rKYBQ319gUpmJ/\\ncq/0CiJx3xI4noG/LLXYFKc/748awhxPUwodOrzNfrI9FZd9X82InuCfSZ6N9QyY\\nEcA84PcOqrcW//0HU1dBUi9GX8GTbyeWpX3bHblx3giT/NGKAfyftsd8xklG2Yaw\\nP2b6VeQqkQKBgQCsX42JWWAbkLBaqXFn4+hAEVYygJdHz9ojV9Wfhsb9DhlVVCwJ\\nBp8gohGa5VhoHClwpcsdVV9wxwbjzWN/9vKHCIUiaqRh8hs8hp5sq0qyEu3tuAYz\\nrgYcHWKOtc45YBrDc2Ge5yV4JXRXtsU3KeUtfcVH5CuzWe3lvZ6Z/20P3QKBgAeS\\n4ehWASXL6wCsNLzJh3fbe74IqYEL+anRxYa8ukFUmoWXANWGV7o3+0qqXnm6DWO2\\neT1U9qFy8haIaJag0XAdKbXr4Jf7+YiV0kscUR6gddGIOVyC2zTHKlSeaATNziBz\\nLBCnfxcauzn6rNQCgDiFR58sSEIW1+IHU7yTSYtRAoGAIpVdJALNbBxwZaeXNxr8\\nYTtvH/RaWPRWmAChyT+EBOVPzodHp+jAMKJdk1j4xfexfFYwKCUTWiQWVcbfWEAy\\nN0L93bqi4605hxGozwJIy44rEIecxUze2pQtTX0uBkTG4WoQ+V21TYe15OcUQ/wJ\\nrNe1feReGqOQLs2F1+8VUTE=\\n-----END PRIVATE KEY-----\\n","client_email":"firebase-adminsdk-py5cf@eventree-chat.iam.gserviceaccount.com","client_id":"100838832527522586720","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url":"https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-py5cf%40eventree-chat.iam.gserviceaccount.com"}')},"./src/config/index.js":
/*!*****************************!*\
  !*** ./src/config/index.js ***!
  \*****************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! dotenv */"dotenv");r.n(n).a.config(),t.default={app_name:process.env.APP_NAME||"App",env_mode:process.env.ENVIRONMENT,hostname:process.env.HOST||"localhost",port:parseInt(process.env.PORT)||4e3,db_host:process.env.DB_HOST,db_port:process.env.DB_PORT,db_name:process.env.DB_NAME,db_user:process.env.DB_USER,db_pass:process.env.DB_PASS,db_dialect:process.env.DB_DIALECT,ssl:"production"==process.env.ENVIRONMENT&&process.env.SSL,mail_sender_name:process.env.MAIL_SENDER_NAME||"",mail_sender_email:process.env.MAIL_SENDER_EMAIL||"",mail_sender_password:process.env.MAIL_SENDER_PASSWORD||"",confirm_mail_subject:process.env.CONFIRM_MAIL_SUBJECT||"PLEASE CONFIRM YOUR EMAIL",reset_password_mail_subject:process.env.RESET_PASSWORD_MAIL_SUBJECT||"RESET PASSWORD",redis_host:process.env.REDIS_HOST,redis_port:process.env.REDIS_PORT,redis_pass:process.env.REDIS_PASS,secret_key:process.env.SECRET_KEY||"",token_expiresin:process.env.TOKEN_EXPIRESIN||"30m",refresh_token_expiresin:process.env.REFRESH_TOKEN_EXPIRESIN||"12h",server_root_url:process.env.SERVER_ROOT_URL||"",web_root_url:process.env.WEB_ROOT_URL||"",activation_code_digit:parseInt(process.env.ACTIVATION_CODE_DIGIT)||6,activation_code_expiresin:parseInt(process.env.ACTIVATION_CODE_EXPIRESIN)||86400,activation_link_url:process.env.ACTIVATION_LINK_URL||"activate",reset_password_link_url:process.env.RESET_PASSWORD_LINK_URL||"resetpassword",company_name:process.env.COMPANY_NAME||"",aws_access_key_id:process.env.AWS_ACCESS_KEY_ID||"",aws_secret_access_key:process.AWS_SECRET_ACCESS_KEY||"",default_avatar:"https://s3.amazonaws.com/37assets/svn/765-default-avatar.png",stripe_key:process.env.STRIPE_KEY||"",service_fee:parseInt(process.env.SERVICE_FEE)||5,firebase_url:process.env.FIREBASE_DATA_URL||""}},"./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/*! no exports provided */function(e,t,r){"use strict";r.r(t);var n=r(/*! express */"express"),a=r.n(n),s=r(/*! http */"http"),i=r.n(s),u=r(/*! body-parser */"body-parser"),o=r.n(u),c=r(/*! cors */"cors"),l=r.n(c),d=r(/*! helmet */"helmet"),f=r.n(d),p=r(/*! ./config */"./src/config/index.js"),m=r(/*! ./model */"./src/model/index.js"),h=r(/*! ./router */"./src/router/index.js"),v=r(/*! ./middleware/passport */"./src/middleware/passport/index.js"),_=r(/*! ./middleware/logger */"./src/middleware/logger/index.js"),y=r(/*! ./middleware/graph */"./src/middleware/graph/index.js"),b=a()();b.use(l()()),b.use(o.a.json({limit:"100mb"})),b.use(o.a.urlencoded({extended:!0,limit:"100mb"})),b.use(f()()),b.use(v.default),Object(h.default)(b);var g=i.a.createServer(b);m.sequelize.sync({force:!1}).then(function(){_.default.info("Connected to database"),y.default.init(),g.listen({port:p.default.port},function(){return _.default.info("ðŸš€ Server ready at: http".concat(p.default.ssl?"s":"","://").concat(p.default.hostname,":").concat(p.default.port))})})},"./src/middleware/graph/index.js":
/*!***************************************!*\
  !*** ./src/middleware/graph/index.js ***!
  \***************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),u=r.n(n),a=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),s=r.n(a),i=r(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),o=r.n(i),c=r(/*! @babel/runtime/helpers/createClass */"@babel/runtime/helpers/createClass"),l=r.n(c),d=r(/*! moment */"moment"),f=r.n(d),p=r(/*! sequelize */"sequelize"),m=r.n(p),h=(r(/*! lodash */"lodash"),r(/*! ../../model */"./src/model/index.js")),v=r(/*! ../logger */"./src/middleware/logger/index.js"),_=r(/*! ./lib/graph */"./src/middleware/graph/lib/graph.js"),y=(m.a.Op,100),b=1,g=2,k=4,w=4,x=6,E=new(function(){function e(){o()(this,e),this.g=new _.default,this.rootNode=this.g.createNode("root",{name:"Root Node"}),this.users={},this.events={},this.posts={},this.relations={},this.likes={},this.comments={}}var t;return l()(e,[{key:"init",value:(t=s()(u.a.mark(function e(){var t,r,n,a,s,i=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.default.User.findAll({where:{status:1},raw:!0});case 2:return t=e.sent,e.next=5,h.default.Event.findAll({where:{status:0},raw:!0});case 5:return r=e.sent,e.next=8,h.default.Relation.findAll({raw:!0});case 8:return n=e.sent,e.next=11,h.default.Reaction.findAll({raw:!0});case 11:return a=e.sent,e.next=14,h.default.Comment.findAll({raw:!0});case 14:s=e.sent,t.forEach(function(e){i.users[e.id]=i.g.createNode("user",e),i.g.createEdge("root").link(i.rootNode,i.users[e.id]).setDistance(y)}),n.forEach(function(e){i.relations[e.id]=i.g.createEdge("relation",e).link(i.users[e.user_id],i.users[e.follower_id]).setDistance(b)}),r.forEach(function(e){i.events[e.id]=i.g.createNode("event",e),i.g.createEdge("root").link(i.rootNode,i.events[e.id]).setDistance(y),i.posts[e.id]=i.g.createEdge("post").link(i.users[e.user_id],i.events[e.id]).setDistance(g)}),s.forEach(function(e){i.comments[e.id]=i.g.createEdge("comment",e).link(i.users[e.user_id],i.events[e.relation_id]).setDistance(w)}),a.forEach(function(e){var t;1==e.value&&(0==e.type?i.likes[e.id]=i.g.createEdge("like",e).link(i.users[e.user_id],i.events[e.relation_id]).setDistance(k):1!=e.type||(t=i.comments[e.relation_id])&&i.events[t.relation_id]&&(i.likes[e.id]=i.g.createEdge("like",e).link(i.users[e.user_id],i.events[t.relation_id]).setDistance(x)))});case 20:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)})},{key:"findEvents",value:function(e,t,r,n){var a=3<arguments.length&&void 0!==n?n:20,s=this.users[e]||this.rootNode;return t=t&&t.toLowerCase(),this.g.closest(s,{compare:function(e){return"event"===e.entity&&(!t||-1<e.get("title").toLowerCase().indexOf(t)||-1<e.get("description").toLowerCase().indexOf(t))&&(!r||f()(e.get("createdAt"))<f()(r))},minDepth:2,count:a}).map(function(e){return e.end()})}},{key:"addUser",value:function(e){e&&!this.users[e.id]?(this.users[e.id]=this.g.createNode("user",e),this.g.createEdge("root").link(this.rootNode,this.users[e.id]).setDistance(y),console.log("graph add user",this.users[e.id])):v.default.error("null value of user")}},{key:"followUser",value:function(e){e?(this.relations[e.id]||(this.relations[e.id]=this.g.createEdge("relation",e)),this.relations[e.id].unlink(),this.relations[e.id].link(this.users[e.user_id],this.users[e.follower_id]).setDistance(b),console.log("graph follow user",this.relations[e.id])):v.default.error("graph follow User error: null value of relation")}},{key:"unfollowUser",value:function(e){e?this.relations[e.id]?(this.relations[e.id].unlink(),delete this.relations[e.id],console.log("graph unfollow user",this.relations[e.id])):v.default.error("graph unfollow User error: not existing relation - "+e):v.default.error("graph unfollow User error: null value of relation")}},{key:"addEvent",value:function(e){e&&!this.events[e.id]?(this.events[e.id]=this.g.createNode("event",e),this.posts[e.id]=this.g.createEdge("post").link(this.users[e.user_id],this.events[e.id]).setDistance(g),console.log("graph add event",this.events[e.id])):v.default.error("null value of event")}},{key:"addLike",value:function(e){var t;e&&!this.likes[e.id]?1==e.value&&(0==e.type?this.likes[e.id]=this.g.createEdge("like",e).link(this.users[e.user_id],this.events[e.relation_id]).setDistance(k):1!=e.type||(t=this.comments[e.relation_id])&&this.events[t.relation_id]&&(this.likes[e.id]=this.g.createEdge("like",e).link(this.users[e.user_id],this.events[t.relation_id]).setDistance(x)),console.log("graph add like",this.likes[e.id])):v.default.error("null value of reaction")}},{key:"updateLike",value:function(e){if(e)if(1==e.value){if(this.likes[e.id])return void v.default.error("graph update like error: duplicated reaction "+e);var t;0==e.type?this.likes[e.id]=this.g.createEdge("like",e).link(this.users[e.user_id],this.events[e.relation_id]).setDistance(k):1!=e.type||(t=this.comments[e.relation_id])&&this.events[t.relation_id]&&(this.likes[e.id]=this.g.createEdge("like",e).link(this.users[e.user_id],this.events[t.relation_id]).setDistance(x)),console.log("graph update like - like:",this.likes[e.id])}else this.likes[e.id]&&(this.likes[e.id].unlink(),delete this.likes[e.id]),console.log("graph update like - unlike:",e);else v.default.error("graph update like error: null value of reaction")}},{key:"addComment",value:function(e){e&&!this.comments[e.id]?(this.comments[e.id]=this.g.createEdge("comment",e).link(this.users[e.user_id],this.events[e.relation_id]).setDistance(w),console.log("graph add comment",e)):v.default.error("null value of comment")}},{key:"deleteComment",value:function(e){e&&this.comments[e.id]?(this.comments[e.id].unlink(),delete this.comments[e.id],console.log("graph delete comment",e)):v.default.error("null value of comment")}}]),e}());t.default=E},"./src/middleware/graph/lib/collection/collection.js":
/*!***********************************************************!*\
  !*** ./src/middleware/graph/lib/collection/collection.js ***!
  \***********************************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),a=r.n(n),s=r(/*! @babel/runtime/helpers/createClass */"@babel/runtime/helpers/createClass"),i=r.n(s),u=r(/*! ../query.js */"./src/middleware/graph/lib/query.js"),o=function(){function t(e){a()(this,t),this._name=e,this._units=[],this._indices=Object.create(null),this._indicesList=[]}return i()(t,[{key:"name",value:function(){return this._name}},{key:"indices",value:function(){return this._indicesList.slice()}},{key:"toJSON",value:function(){return[this._name,this._indicesList.slice()]}},{key:"createIndex",value:function(e){return this.createIndices([e])}},{key:"createIndices",value:function(e){this._indicesList=this._indicesList.concat(e);for(var t=this._indices,r=this._units,n=0,a=e.length;n<a;n++)for(var s=e[n],i=t[s]=Object.create(null),u=0,o=r.length;u<o;u++){var c=r[u],l=c.get(s);l&&(i[l]=c)}return this}},{key:"_add",value:function(e){if(e){this._units.push(e);for(var t=this._indicesList,r=t.length,n=this._indices,a=0;a<r;a++){var s=t[a],i=n[s],u=e.get(s);u&&(i[u]=e)}}return e}},{key:"_remove",value:function(e){if(e){var t=this._units.indexOf(e);-1<t&&this._units.splice(t,1);for(var r=this._indicesList,n=r.length,a=this._indices,s=0;s<n;s++){var i=r[s];delete a[i][e.get(i)]}}return e}},{key:"find",value:function(e,t){t||(t=e,e=this._indicesList[0]);var r=this._indices[e];return r&&r[t]}},{key:"destroy",value:function(e,t){t||(t=e,e=this._indicesList[0]);var r=this._indices[e];return r&&this._remove(r[t])}},{key:"query",value:function(){return new u.default(this._units)}}]),t}();t.default=o},"./src/middleware/graph/lib/collection/edge_collection.js":
/*!****************************************************************!*\
  !*** ./src/middleware/graph/lib/collection/edge_collection.js ***!
  \****************************************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),a=r.n(n),s=r(/*! @babel/runtime/helpers/inherits */"@babel/runtime/helpers/inherits"),i=r.n(s),u=r(/*! @babel/runtime/helpers/possibleConstructorReturn */"@babel/runtime/helpers/possibleConstructorReturn"),o=r.n(u),c=r(/*! @babel/runtime/helpers/getPrototypeOf */"@babel/runtime/helpers/getPrototypeOf"),l=r.n(c);function d(n){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r=l()(n);return t=a?(e=l()(this).constructor,Reflect.construct(r,arguments,e)):r.apply(this,arguments),o()(this,t)}}var f=function(e){i()(r,e);var t=d(r);function r(){return a()(this,r),t.apply(this,arguments)}return r}(r(/*! ./collection.js */"./src/middleware/graph/lib/collection/collection.js").default);t.default=f},"./src/middleware/graph/lib/collection/node_collection.js":
/*!****************************************************************!*\
  !*** ./src/middleware/graph/lib/collection/node_collection.js ***!
  \****************************************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),a=r.n(n),s=r(/*! @babel/runtime/helpers/inherits */"@babel/runtime/helpers/inherits"),i=r.n(s),u=r(/*! @babel/runtime/helpers/possibleConstructorReturn */"@babel/runtime/helpers/possibleConstructorReturn"),o=r.n(u),c=r(/*! @babel/runtime/helpers/getPrototypeOf */"@babel/runtime/helpers/getPrototypeOf"),l=r.n(c);function d(n){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r=l()(n);return t=a?(e=l()(this).constructor,Reflect.construct(r,arguments,e)):r.apply(this,arguments),o()(this,t)}}var f=function(e){i()(r,e);var t=d(r);function r(){return a()(this,r),t.apply(this,arguments)}return r}(r(/*! ./collection.js */"./src/middleware/graph/lib/collection/collection.js").default);t.default=f},"./src/middleware/graph/lib/graph.js":
/*!*******************************************!*\
  !*** ./src/middleware/graph/lib/graph.js ***!
  \*******************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),a=r.n(n),s=r(/*! @babel/runtime/helpers/createClass */"@babel/runtime/helpers/createClass"),i=r.n(s),u=r(/*! fs */"fs"),o=r.n(u),c=r(/*! zlib */"zlib"),l=r.n(c),d=r(/*! ./unit/node.js */"./src/middleware/graph/lib/unit/node.js"),f=r(/*! ./unit/edge.js */"./src/middleware/graph/lib/unit/edge.js"),p=r(/*! ./collection/node_collection.js */"./src/middleware/graph/lib/collection/node_collection.js"),m=r(/*! ./collection/edge_collection.js */"./src/middleware/graph/lib/collection/edge_collection.js"),h=r(/*! ./path.js */"./src/middleware/graph/lib/path.js"),v=function(){function e(){a()(this,e),this.__uniqval__=Number.MAX_SAFE_INTEGER,this.__init__()}return i()(e,[{key:"__init__",value:function(){this._lookup=Object.create(null),this._nodes=[],this._edges=[],this._nodeCollections=Object.create(null),this._edgeCollections=Object.create(null)}},{key:"unit",value:function(e){return this._lookup[e]}},{key:"nodeCount",value:function(){return this._nodes.length}},{key:"edgeCount",value:function(){return this._edges.length}},{key:"createNode",value:function(e,t){return this._createNode(e,t,(this.__uniqval__--).toString(16))}},{key:"_createNode",value:function(e,t,r){return this._addNode(new d.default(e,t,r))}},{key:"_addNode",value:function(e){return this._nodes.push(e),this._lookup[e.__uniqid__]=e,this.nodes(e.entity)._add(e)}},{key:"createEdge",value:function(e,t){return this._createEdge(e,t,(this.__uniqval__--).toString(16))}},{key:"_createEdge",value:function(e,t,r){return this._addEdge(new f.default(e,t,r))}},{key:"_addEdge",value:function(e){return this._edges.push(e),this._lookup[e.__uniqid__]=e,this.edges(e.entity)._add(e)}},{key:"nodes",value:function(e){return this._nodeCollections[e]||(this._nodeCollections[e]=new p.default(e))}},{key:"edges",value:function(e){return this._edgeCollections[e]||(this._edgeCollections[e]=new m.default(e))}},{key:"_getPath",value:function(e,t){for(var r=t[e.__uniqid__];r[0]instanceof f.default;)r=t[r[0].oppositeNode(r[1]).__uniqid__].concat(r);return r}},{key:"closest",value:function(e,t){return t=t||{},this._search(e,t.compare,t.count,t.direction,t.minDepth,t.maxDepth)}},{key:"trace",value:function(e,t,r){return this._search(e,function(e){return e===t},1,r)[0]||new h.default([])}},{key:"_search",value:function(e,u,t,o,c,l){u="function"==typeof u?u:function(e){return!0},o|=0,t=Math.max(0,0|t),c=Math.max(0,0|c),l=Math.max(0,0|l);var d=Object.create(null);d[e.__uniqid__]=[e];var r=new Map;r.set(0,[e]);var n=[0],a=[],f=this._getPath;function p(e,t){r.has(t)?r.get(t).push(e):r.set(t,[e]),function(e,t){var r=e.length,n=r>>>1;for(;r;){if(r>>>=1,e[n]===t)return;e[n]<t?n+=r:n-=r}e.splice(n+(e[n]<t),0,t)}(n,t)}for(;n.length;)for(var s=n.shift(),i=r.get(s);i.length;){var m=function(e,t){for(var r=0===o?e.edges:0<o?e.outputEdges:e.inputEdges,n=r.length-1;-1<n;n--){var a,s=r[n],i=t+s.distance;l&&l<i||(a=r[n].oppositeNode(e),d[a.__uniqid__]||(d[a.__uniqid__]=[s,a],p(a,i)))}return!!(c<=t&&u(e))&&new h.default(f(e,d))}(i.shift(),s);if(m&&a.push(m),t&&a.length>=t)return a}return a}},{key:"toJSON",value:function(){var t=this._nodeCollections,e=Object.keys(t).map(function(e){return t[e].toJSON()}),r=this._edgeCollections,n=Object.keys(r).map(function(e){return r[e].toJSON()}),a=this._nodes.map(function(e){return e.toJSON()}),s=this._edges.map(function(e){return e.toJSON()});return JSON.stringify({nc:e,ec:n,n:a,e:s})}},{key:"fromJSON",value:function(e){this.__init__();for(var t=JSON.parse(e),r=t.nc,n=t.ec,a=0,s=r.length;a<s;a++){var i=r[a];this.nodes(i[0]).createIndices(i[1])}for(var u=0,o=n.length;u<o;u++){var c=n[u];this.edges(c[0]).createIndices(c[1])}for(var l=t.n,d=t.e,f=0,p=l.length;f<p;f++){var m=l[f];this._createNode(m[0],m[1],m[2]);var h=parseInt(m[2],16);this.__uniqval__=h<this.__uniqval__?h-1:this.__uniqval__}for(var v=0,_=d.length;v<_;v++){var y=d[v];this._createEdge(y[0],y[1],y[2]).link(this._lookup[y[3]],this._lookup[y[4]],y[5]).setDistance(y[6]);var b=parseInt(y[2],16);this.__uniqval__=b<this.__uniqval__?b-1:this.__uniqval__}return this}},{key:"gzip",value:function(e){var t=new Buffer(this.toJSON());return e=e.bind(this),l.a.gzip(t,e),this}},{key:"gunzip",value:function(e,r){r=r.bind(this);var n=this.fromJSON.bind(this);Buffer.isBuffer(e)||(e=new Buffer(e,"binary")),l.a.gunzip(e,function(e,t){e||n(t.toString()),r(e)})}},{key:"save",value:function(r,n){return n=n.bind(this),this.gzip(function(e,t){e?n(e):o.a.writeFile(r,t,n)}),this}},{key:"load",value:function(e,r){r=r.bind(this);var n=this.gunzip.bind(this);return o.a.readFile(e,function(e,t){e?r(e):n(t,r)}),this}}]),e}();t.default=v},"./src/middleware/graph/lib/path.js":
/*!******************************************!*\
  !*** ./src/middleware/graph/lib/path.js ***!
  \******************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),a=r.n(n),s=r(/*! @babel/runtime/helpers/createClass */"@babel/runtime/helpers/createClass"),i=r.n(s),u=function(){function t(e){a()(this,t),this._raw=e.slice()}return i()(t,[{key:"start",value:function(){return this._raw[0]}},{key:"end",value:function(){return this._raw[this._raw.length-1]}},{key:"length",value:function(){return this._raw.length>>>1}},{key:"distance",value:function(){return this._raw.filter(function(e,t){return!!(1&t)}).reduce(function(e,t){return e+t.distance},0)}},{key:"prettify",value:function(){return this._raw.map(function(e,t,r){var n=e.toString();if(1&t){if(e.duplex)return["<>",n,"<>"].join(" ");var a=r[t-1];return e.inputNode===a?[">>",n,">>"].join(" "):["<<",n,"<<"].join(" ")}return n}).join(" ")}},{key:"toString",value:function(){return this.prettify()}}]),t}();t.default=u},"./src/middleware/graph/lib/query.js":
/*!*******************************************!*\
  !*** ./src/middleware/graph/lib/query.js ***!
  \*******************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/helpers/typeof */"@babel/runtime/helpers/typeof"),q=r.n(n),a=r(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),s=r.n(a),i=r(/*! @babel/runtime/helpers/createClass */"@babel/runtime/helpers/createClass"),u=r.n(i),I={is:function(e,t){return e===t},not:function(e,t){return e!==t},gt:function(e,t){return t<e},lt:function(e,t){return e<t},gte:function(e,t){return t<=e},lte:function(e,t){return e<=t},ilike:function(e,t){return-1<e.toLowerCase().indexOf(t.toLowerCase())},like:function(e,t){return-1<e.indexOf(t)},in:function(e,t){return-1<t.indexOf(e)},not_in:function(e,t){return-1===t.indexOf(e)}},o=function(){function R(e){s()(this,R),this._units=e.slice()}return u()(R,[{key:"__filter",value:function(e,t){t=!!t;for(var r=0,n=e.length;r<n;r++)"object"===q()(e[r])&&null!==e[r]||(e[r]={});e.length||(e=[{}]);for(var a,s,i,u,o,c,l,d,f,p=this._units.slice(),m=e.length,h=0;h!==m;h++){a=e[h],u=[];for(var v=0,_=(s=Object.keys(a)).length;v<_;v++){if((o=(i=s[v]).split("__")).length<2&&o.push("is"),c=o.pop(),!I[c])throw new Error('Filter type "'+c+'" not supported.');u.push([I[c],o,a[i]])}e[h]=u}var y,b=p.length,g=0,k=Array(b);try{for(var w=0;w!==b;w++)for(var x=p[w],E=x.properties,N=!0,j=0;j!==m&&N;j++){N=!1,f=(u=e[j]).length;for(var T=0;T!==f&&!N;T++){d=(l=u[T])[0],y=E,i=l[1];for(var O=0,A=i.length;O!==A;O++)y=y[i[O]];d(y,l[2])===t&&(N=!0)}N||(k[g++]=x)}}catch(e){throw console.log(e),new Error("Nested field "+i.join("__")+" does not exist")}return new R(k=k.slice(0,g))}},{key:"filter",value:function(){var e=(e=[].slice.call(arguments))[0]instanceof Array?e[0]:e;return this.__filter(e,!1)}},{key:"exclude",value:function(){var e=(e=[].slice.call(arguments))[0]instanceof Array?e[0]:e;return this.__filter(e,!0)}},{key:"first",value:function(){return this._units[0]}},{key:"last",value:function(){var e=this._units;return e[e.length-1]}},{key:"units",value:function(){return this._units.slice()}}]),R}();t.default=o},"./src/middleware/graph/lib/unit/edge.js":
/*!***********************************************!*\
  !*** ./src/middleware/graph/lib/unit/edge.js ***!
  \***********************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),i=r.n(n),a=r(/*! @babel/runtime/helpers/createClass */"@babel/runtime/helpers/createClass"),u=r.n(a),s=r(/*! @babel/runtime/helpers/get */"@babel/runtime/helpers/get"),o=r.n(s),c=r(/*! @babel/runtime/helpers/inherits */"@babel/runtime/helpers/inherits"),l=r.n(c),d=r(/*! @babel/runtime/helpers/possibleConstructorReturn */"@babel/runtime/helpers/possibleConstructorReturn"),f=r.n(d),p=r(/*! @babel/runtime/helpers/getPrototypeOf */"@babel/runtime/helpers/getPrototypeOf"),m=r.n(p);function h(n){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r=m()(n);return t=a?(e=m()(this).constructor,Reflect.construct(r,arguments,e)):r.apply(this,arguments),f()(this,t)}}var v=function(e){l()(s,e);var a=h(s);function s(e,t,r){var n;return i()(this,s),(n=a.call(this,e,t,r)).inputNode=null,n.outputNode=null,n.duplex=!1,n.distance=1,n}return u()(s,[{key:"_linkTo",value:function(e,t){return t<=0&&e.inputEdges.push(this),0<=t&&e.outputEdges.push(this),e.edges.push(this),!0}},{key:"link",value:function(e,t,r){return this.unlink(),this.inputNode=e,this.outputNode=t,this.duplex=!!r,r?(this._linkTo(e,0),this._linkTo(t,0)):(this._linkTo(e,1),this._linkTo(t,-1)),this}},{key:"setDistance",value:function(e){return this.distance=Math.abs(parseFloat(e)||0),this}},{key:"setWeight",value:function(e){return this.distance=1/Math.abs(parseFloat(e)||0),this}},{key:"oppositeNode",value:function(e){return this.inputNode===e?this.outputNode:this.outputNode===e?this.inputNode:void 0}},{key:"unlink",value:function(){var e,t=this.inputNode,r=this.outputNode;if(t&&r)return-1<(e=t.edges.indexOf(this))&&t.edges.splice(e,1),-1<(e=r.edges.indexOf(this))&&r.edges.splice(e,1),-1<(e=t.outputEdges.indexOf(this))&&t.outputEdges.splice(e,1),-1<(e=r.inputEdges.indexOf(this))&&r.inputEdges.splice(e,1),this.duplex&&(-1<(e=t.inputEdges.indexOf(this))&&t.inputEdges.splice(e,1),-1<(e=r.outputEdges.indexOf(this))&&r.outputEdges.splice(e,1)),this.inputNode=null,this.outputNode=null,!(this.duplex=!1)}},{key:"toJSON",value:function(){return o()(m()(s.prototype),"toJSON",this).call(this).concat([this.inputNode.__uniqid__,this.outputNode.__uniqid__,0|this.duplex,this.distance])}}]),s}(r(/*! ./unit.js */"./src/middleware/graph/lib/unit/unit.js").default);t.default=v},"./src/middleware/graph/lib/unit/node.js":
/*!***********************************************!*\
  !*** ./src/middleware/graph/lib/unit/node.js ***!
  \***********************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),i=r.n(n),a=r(/*! @babel/runtime/helpers/createClass */"@babel/runtime/helpers/createClass"),u=r.n(a),s=r(/*! @babel/runtime/helpers/get */"@babel/runtime/helpers/get"),o=r.n(s),c=r(/*! @babel/runtime/helpers/inherits */"@babel/runtime/helpers/inherits"),l=r.n(c),d=r(/*! @babel/runtime/helpers/possibleConstructorReturn */"@babel/runtime/helpers/possibleConstructorReturn"),f=r.n(d),p=r(/*! @babel/runtime/helpers/getPrototypeOf */"@babel/runtime/helpers/getPrototypeOf"),m=r.n(p);function h(n){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r=m()(n);return t=a?(e=m()(this).constructor,Reflect.construct(r,arguments,e)):r.apply(this,arguments),f()(this,t)}}var v=function(e){l()(s,e);var a=h(s);function s(e,t,r){var n;return i()(this,s),(n=a.call(this,e,t,r)).edges=[],n.inputEdges=[],n.outputEdges=[],n}return u()(s,[{key:"unlink",value:function(){for(var e=this.edges,t=0,r=e.length;t<r;t++)e[t].unlink();return!0}},{key:"toJSON",value:function(){return o()(m()(s.prototype),"toJSON",this).call(this)}}]),s}(r(/*! ./unit.js */"./src/middleware/graph/lib/unit/unit.js").default);t.default=v},"./src/middleware/graph/lib/unit/unit.js":
/*!***********************************************!*\
  !*** ./src/middleware/graph/lib/unit/unit.js ***!
  \***********************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),a=r.n(n),s=r(/*! @babel/runtime/helpers/createClass */"@babel/runtime/helpers/createClass"),i=r.n(s),u=function(){function n(e,t,r){a()(this,n),this.entity=e+"",this.__uniqid__=r,this.load(t||{})}return i()(n,[{key:"load",value:function(t){var r=Object.create(null);return Object.keys(t).forEach(function(e){r[e]=t[e]}),this.properties=r,this}},{key:"set",value:function(e,t){return this.properties[e]=t}},{key:"unset",value:function(e){return delete this.properties[e]}},{key:"has",value:function(e){return Object.prototype.hasOwnProperty.call(this.properties,e)}},{key:"get",value:function(e){return this.properties[e]}},{key:"toString",value:function(){return[this.constructor.name," (",this.entity," ",JSON.stringify(this.properties),")"].join("")}},{key:"valueOf",value:function(){return this.toString()}},{key:"toJSON",value:function(){return[this.entity,this.properties,this.__uniqid__]}}]),n}();t.default=u},"./src/middleware/logger/index.js":
/*!****************************************!*\
  !*** ./src/middleware/logger/index.js ***!
  \****************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! winston */"winston"),a=r(/*! winston-daily-rotate-file */"winston-daily-rotate-file"),s=r.n(a),i=r(/*! fs */"fs"),u=r.n(i),o=r(/*! ../../config */"./src/config/index.js"),c=n.format.combine,l=n.format.timestamp,d=n.format.label,f=n.format.simple,p=n.format.printf,m=n.format.colorize;u.a.existsSync("logs")||u.a.mkdirSync("logs");var h=Object(n.createLogger)({level:"info",format:c(d({label:o.default.app_name}),l({format:"YYYY-MM-DD HH:mm:ss"}),f(),p(function(e){var t=e.padding&&e.padding[e.level]||"";return"".concat(e.timestamp," [").concat(e.label,"] ").concat(e.level,":").concat(t," ").concat(e.message)}),m()),transports:[new s.a({filename:"logs/error.log",level:"error"}),new s.a({filename:"logs/info.log",level:"info"})]});h.add(new n.transports.Console({format:f()})),t.default=h},"./src/middleware/logger/stripe.js":
/*!*****************************************!*\
  !*** ./src/middleware/logger/stripe.js ***!
  \*****************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! winston */"winston"),a=r(/*! winston-daily-rotate-file */"winston-daily-rotate-file"),s=r.n(a),i=r(/*! fs */"fs"),u=r.n(i),o=r(/*! ../../config */"./src/config/index.js"),c=n.format.combine,l=n.format.timestamp,d=n.format.label,f=n.format.simple,p=n.format.printf,m=n.format.colorize;u.a.existsSync("logs")||u.a.mkdirSync("logs");var h=Object(n.createLogger)({level:"info",format:c(d({label:o.default.app_name}),l({format:"YYYY-MM-DD HH:mm:ss"}),f(),p(function(e){var t=e.padding&&e.padding[e.level]||"";return"".concat(e.timestamp," [").concat(e.label,"] ").concat(e.level,":").concat(t," ").concat(e.message)}),m()),transports:[new s.a({filename:"logs/stripe.log"})]});h.add(new n.transports.Console({format:f()})),t.default=h},"./src/middleware/mailer/index.js":
/*!****************************************!*\
  !*** ./src/middleware/mailer/index.js ***!
  \****************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! ./nodemailer */"./src/middleware/mailer/nodemailer.js");t.default=n.default},"./src/middleware/mailer/nodemailer.js":
/*!*********************************************!*\
  !*** ./src/middleware/mailer/nodemailer.js ***!
  \*********************************************/
/*! exports provided: default */function(e,w,x){"use strict";x.r(w),function(n){var e=x(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),c=x.n(e),t=x(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),a=x.n(t),r=x(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),s=x.n(r),i=x(/*! @babel/runtime/helpers/createClass */"@babel/runtime/helpers/createClass"),u=x.n(i),o=x(/*! nodemailer */"nodemailer"),l=x.n(o),d=x(/*! handlebars */"handlebars"),f=x.n(d),p=x(/*! path */"path"),m=x.n(p),h=x(/*! fs */"fs"),v=x.n(h),_=x(/*! ../../config */"./src/config/index.js"),y=x(/*! ../logger */"./src/middleware/logger/index.js"),b=function(){function e(){s()(this,e),this.transporter=l.a.createTransport({service:"gmail",host:"smtp.gmail.com",port:465,secure:!0,auth:{user:_.default.mail_sender_email,pass:_.default.mail_sender_password}})}var t,r;return u()(e,[{key:"sendConfirmationEmail",value:(r=a()(c.a.mark(function e(t){var r,n,a,s,i,u,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.first_name,n=t.last_name,a=t.email,s=t.activation_code,i=t.activation_link,u=g({name:"".concat(r," ").concat(n),activation_link:i,activation_code:s,company_name:_.default.company_name},"./templates/confirm-email.html"),e.next=4,this.transporter.sendMail({from:'"'.concat(_.default.mail_sender_name,'" ').concat(_.default.mail_sender_email),to:a,subject:_.default.confirm_mail_subject,html:u});case 4:return o=e.sent,y.default.info("Message sent: ".concat(o.messageId)),y.default.info("Preview URL: ".concat(l.a.getTestMessageUrl(o))),e.abrupt("return",o);case 8:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"sendResetPasswordMail",value:(t=a()(c.a.mark(function e(t){var r,n,a,s,i,u,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.first_name,n=t.last_name,a=t.email,s=t.activation_code,i=t.activation_link,u=g({name:"".concat(r," ").concat(n),activation_link:i,activation_code:s,company_name:_.default.company_name},"./templates/reset-password-email.html"),e.next=4,this.transporter.sendMail({from:'"'.concat(_.default.mail_sender_name,'" ').concat(_.default.mail_sender_email),to:a,subject:_.default.reset_password_mail_subject,html:u});case 4:return o=e.sent,y.default.info("Message sent: ".concat(o.messageId)),y.default.info("Preview URL: ".concat(l.a.getTestMessageUrl(o))),e.abrupt("return",o);case 8:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})}]),e}(),g=function(e,t){var r=function(e){try{return v.a.readFileSync(e,{encoding:"utf-8"})}catch(e){throw y.default.error(e),e}}(m.a.join(n,t));return f.a.compile(r)(e)},k=new b;w.default=k}.call(this,"src\\middleware\\mailer")},"./src/middleware/notification/index.js":
/*!**********************************************!*\
  !*** ./src/middleware/notification/index.js ***!
  \**********************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),f=r.n(n),a=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),s=r.n(a),i=r(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),u=r.n(i),o=r(/*! @babel/runtime/helpers/createClass */"@babel/runtime/helpers/createClass"),c=r.n(o),l=r(/*! firebase-admin */"firebase-admin"),d=r(/*! ../../config */"./src/config/index.js"),p=r(/*! ../../model */"./src/model/index.js");function m(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,u=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw s}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var v=r(/*! ../../../firebase_key.json */"./firebase_key.json");l.initializeApp({credential:l.credential.cert(v),databaseURL:d.default.firebase_url});var _=new(function(){function e(){u()(this,e)}var n,r,a;return c()(e,[{key:"sendNotification",value:(a=s()(f.a.mark(function e(t,r,n){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.messaging().sendMulticast({tokens:t,notification:{title:r,body:n}});case 2:case"end":return e.stop()}},e)})),function(e,t,r){return a.apply(this,arguments)})},{key:"sendFollowNotification",value:(r=s()(f.a.mark(function e(t,r){var n,a,s,i=arguments;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="Follow",a=r+(0===(2<i.length&&void 0!==i[2]?i[2]:0)?" starts ":" no longer ")+"following you",e.next=5,p.default.Notification.create({user_id:t,title:n,content:a,read:0});case 5:return e.next=7,p.default.NotificationToken.findOne({where:{user_id:t}});case 7:(s=e.sent)&&this.sendNotification([s.token],n,a);case 9:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"sendEventCreateNotification",value:(n=s()(f.a.mark(function e(t,r,n){var a,s,i,u,o,c,l,d;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.default.Relation.findAll({nest:!1,raw:!0,where:{user_id:t},attributes:["id"],include:[{model:p.default.User,as:"follower",attributes:["id"],required:!0,include:[{model:p.default.NotificationToken,as:"my_notification_token",attributes:["token"],required:!0}]}]});case 2:if(0===(a=e.sent).length)return e.abrupt("return");e.next=5;break;case 5:s="Event",i="".concat(r,' just created new event "').concat(n,'"'),u=[],o=[],c=m(a);try{for(c.s();!(l=c.n()).done;)d=l.value,u.push({user_id:d["follower.id"],title:s,content:i,read:0}),o.push(d["follower.my_notification_token.token"])}catch(e){c.e(e)}finally{c.f()}return e.next=13,p.default.Notification.bulkCreate(u);case 13:this.sendNotification(o,s,i);case 14:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})}]),e}());t.default=_},"./src/middleware/passport/index.js":
/*!******************************************!*\
  !*** ./src/middleware/passport/index.js ***!
  \******************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! passport */"passport"),a=r.n(n),s=r(/*! passport-local */"passport-local"),i=r(/*! passport-jwt */"passport-jwt"),u=r(/*! ../../config */"./src/config/index.js"),o=r(/*! ../../model */"./src/model/index.js"),c=a.a.initialize();a.a.use("local",new s.Strategy({usernameField:"email",passwordField:"password"},function(e,r,n){return o.default.User.findByLogin(e).then(function(t){return t?void t.validatePassword(r).then(function(e){return e?void n(null,t,{message:"Logged In Successfully"}):n({status:401,message:"Incorrect email or password."},!1)}).catch(function(e){return n(e)}):n({status:401,message:"Incorrect email or password."},!1)}).catch(function(e){return n(e)})}));var l={jwtFromRequest:i.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:u.default.secret_key,ignoreExpiration:!0};a.a.use("jwt",new i.Strategy(l,function(e,t){o.default.User.findOne({where:{email:e.email}}).then(function(e){return t(null,e||!1)}).catch(function(e){if(e)return t(e,!1)})})),a.a.serializeUser(function(e,t){t(null,e.id)}),a.a.deserializeUser(function(e,t){o.default.User.findByPk(e).then(function(e){return t(null,e||!1)}).catch(function(e){if(e)return t(e,!1)})}),t.default=c},"./src/middleware/stripe.js":
/*!**********************************!*\
  !*** ./src/middleware/stripe.js ***!
  \**********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),f=r.n(n),a=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),p=r.n(a),s=r(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),m=r.n(s),i=r(/*! @babel/runtime/helpers/createClass */"@babel/runtime/helpers/createClass"),h=r.n(i),u=r(/*! stripe */"stripe"),v=r.n(u),_=r(/*! ../config */"./src/config/index.js"),y=r(/*! ./logger/stripe */"./src/middleware/logger/stripe.js"),o=new(function(){function e(){m()(this,e),this.stripe=new v.a(_.default.stripe_key)}var r,t,n,a,s,i,u,o,c,l,d;return h()(e,[{key:"createPaymentIntent",value:(d=p()(f.a.mark(function e(t,r,n){var a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stripe.paymentIntents.create({amount:t,currency:r,customer:n});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e,this)})),function(e,t,r){return d.apply(this,arguments)})},{key:"createCharge",value:(l=p()(f.a.mark(function e(t,r,n){var a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("TOKEN",n),e.next=3,this.stripe.charges.create({amount:t,currency:r,source:n,description:"Charge"});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)})),function(e,t,r){return l.apply(this,arguments)})},{key:"getPaymentMethod",value:(c=p()(f.a.mark(function e(t){var r;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stripe.paymentMethods.retrieve(t);case 3:r=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),y.default.error("error on getting stripe payment method:",e.t0);case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}},e,this,[[0,6]])})),function(e){return c.apply(this,arguments)})},{key:"attachPaymentMethod",value:(o=p()(f.a.mark(function e(t,r){var n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stripe.paymentMethods.attach(t,{customer:r});case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),y.default.error("error on attach stripe payment method to customer:",e.t0);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}},e,this,[[0,6]])})),function(e,t){return o.apply(this,arguments)})},{key:"getToken",value:(u=p()(f.a.mark(function e(t){var r;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stripe.tokens.retrieve(t);case 3:r=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),y.default.error("error on getting stripe token:",e.t0);case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}},e,this,[[0,6]])})),function(e){return u.apply(this,arguments)})},{key:"createCustomer",value:(i=p()(f.a.mark(function e(t,r){var n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stripe.customers.create({name:t,email:r});case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),y.default.error("error on creating stripe customer:",e.t0);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}},e,this,[[0,6]])})),function(e,t){return i.apply(this,arguments)})},{key:"createCustomerWithPaymentMethod",value:(s=p()(f.a.mark(function e(t,r,n){var a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stripe.customers.create({payment_method:t,name:r,email:n,invoice_settings:{default_payment_method:t}});case 3:a=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),y.default.error("error on creating stripe customer:",e.t0);case 9:return e.abrupt("return",a);case 10:case"end":return e.stop()}},e,this,[[0,6]])})),function(e,t,r){return s.apply(this,arguments)})},{key:"createCustomerWithToken",value:(a=p()(f.a.mark(function e(t,r,n){var a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stripe.customers.create({name:r,email:n,source:t});case 3:a=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),y.default.error("error on creating stripe customer:",e.t0);case 9:return e.abrupt("return",a);case 10:case"end":return e.stop()}},e,this,[[0,6]])})),function(e,t,r){return a.apply(this,arguments)})},{key:"getCustomer",value:(n=p()(f.a.mark(function e(t){var r;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.stripe.customers.retrieve(t);case 3:r=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),y.default.error("error on getting stripe customer:",e.t0);case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}},e,this,[[0,6]])})),function(e){return n.apply(this,arguments)})},{key:"getCustomerDefaultSource",value:(t=p()(f.a.mark(function e(t){var r;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t&&t.default_source)return e.next=4,this.stripe.customers.retrieveSource(t.id,t.default_source);e.next=5;break;case 4:r=e.sent;case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),y.default.error("error on getting stripe customer default source:",e.t0);case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this,[[0,7]])})),function(e){return t.apply(this,arguments)})},{key:"updateCustomer",value:(r=p()(f.a.mark(function e(t,r){var n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!1,e.prev=1,e.next=4,this.stripe.customers.update(t,r);case 4:n=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),y.default.error("error on updating stripe customer:",e.t0);case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}},e,this,[[1,7]])})),function(e,t){return r.apply(this,arguments)})}]),e}());t.default=o},"./src/middleware/uploader/index.js":
/*!******************************************!*\
  !*** ./src/middleware/uploader/index.js ***!
  \******************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/helpers/classCallCheck */"@babel/runtime/helpers/classCallCheck"),a=r.n(n),s=r(/*! @babel/runtime/helpers/createClass */"@babel/runtime/helpers/createClass"),i=r.n(s),u=r(/*! aws-sdk */"aws-sdk"),o=r.n(u),c=r(/*! ../../config */"./src/config/index.js"),l=r(/*! ../logger */"./src/middleware/logger/index.js"),d=r(/*! fs */"fs"),f=r.n(d),p=r(/*! uuid */"uuid"),m=new o.a.S3({accessKeyId:c.default.aws_access_key_id,secretAccessKey:c.default.aws_secret_access_key}),h=new(function(){function e(){a()(this,e)}return i()(e,[{key:"uploadFile",value:function(e){try{var t=f.a.readFileSync(e.path),r="png";-1<e.name.lastIndexOf(".")&&(r=e.name.split(".")[1]);var n={Bucket:"eventree-bucket",Key:"".concat(Object(p.v4)(),".").concat(r),Body:t};return m.upload(n).promise().then(function(e){return l.default.info("File uploaded successfully. ".concat(e.Location)),e}).catch(function(e){throw e})}catch(e){throw l.default.error("Error uploading to s3 :",e),e}}},{key:"upload64",value:function(e){try{var t=e.uri,r=(e.name,new Buffer.from(t.replace(/^data:image\/\w+;base64,/,""),"base64")),n=t.split(";")[0].split("/")[1],a={Bucket:"eventree-bucket",Key:"".concat(Object(p.v4)(),".").concat(n),Body:r,ACL:"public-read",ContentEncoding:"base64",ContentType:"image/".concat(n)};return m.upload(a).promise().then(function(e){return l.default.info("File uploaded successfully. ".concat(e.Location)),e}).catch(function(e){throw e})}catch(e){throw l.default.error("Error uploading to s3 :",e),e}}}]),e}());t.default=h},"./src/model/activation.js":
/*!*********************************!*\
  !*** ./src/model/activation.js ***!
  \*********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("activation",{user_id:{type:t.INTEGER,allowNull:!1,validate:{notEmpty:!0}},code:{type:t.STRING,allowNull:!1,validate:{notEmpty:!0}},hash:{type:t.STRING,allowNull:!1,validate:{notEmpty:!0}},status:{type:t.INTEGER,allowNull:!1,defaultValue:0,validate:{isNumeric:!0},comment:"0 - created, 1 - success, 2 - failed"},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/attend.js":
/*!*****************************!*\
  !*** ./src/model/attend.js ***!
  \*****************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("attend",{event_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},user_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/comment.js":
/*!******************************!*\
  !*** ./src/model/comment.js ***!
  \******************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("comment",{relation_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},type:{type:t.INTEGER,default:0,allowNull:!1,validate:{isNumeric:!0}},user_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},text:{type:t.TEXT,allowNull:!1,validate:{notEmpty:!0}},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/community.js":
/*!********************************!*\
  !*** ./src/model/community.js ***!
  \********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("community",{user_id:{type:t.INTEGER,allowNull:!1,validate:{notEmpty:!0}},title:{type:t.STRING,allowNull:!1,validate:{notEmpty:!0}},content:{type:t.TEXT("long"),allowNull:!1,validate:{notEmpty:!0}},poster:{type:t.STRING,allowNull:!1,validate:{notEmpty:!0}},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/event.js":
/*!****************************!*\
  !*** ./src/model/event.js ***!
  \****************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("event",{user_id:{type:t.INTEGER,allowNull:!1,validate:{notEmpty:!0}},title:{type:t.STRING,allowNull:!1,validate:{notEmpty:!0}},description:{type:t.TEXT,allowNull:!1,validate:{notEmpty:!0}},content:{type:t.TEXT,allowNull:!1,validate:{notEmpty:!0}},online_event:{type:t.INTEGER,allowNull:!1,validate:{notEmpty:!0}},location:{type:t.STRING,allowNull:!1,validate:{notEmpty:!1}},lat:{type:t.DOUBLE,allowNull:!1,default:0,validate:{notEmpty:!1}},lng:{type:t.DOUBLE,allowNull:!1,default:0,validate:{notEmpty:!1}},total_ticket:{type:t.INTEGER,allowNull:!1,validate:{notEmpty:!0}},ticket_limit:{type:t.INTEGER,allowNull:!1,validate:{notEmpty:!0}},poster:{type:t.STRING,allowNull:!1,validate:{notEmpty:!0}},start_date:{field:"create_date",type:t.DATE,defaultValue:t.NOW},end_date:{field:"create_date",type:t.DATE,defaultValue:t.NOW},free_event:{type:t.INTEGER,allowNull:!1,validate:{notEmpty:!0}},price:{type:t.FLOAT,allowNull:!1,validate:{notEmpty:!0}},restriction_age:{type:t.INTEGER,allowNull:!0},restriction_dress:{type:t.TEXT,allowNull:!0},restriction_refund:{type:t.TEXT,allowNull:!0},restriction_id:{type:t.INTEGER,allowNull:!1,defaultValue:0,comment:"0 - not required, 1 - required"},restriction_cash:{type:t.INTEGER,allowNull:!1,defaultValue:0,comment:"0 - not accepted, 1 - accepted"},qrcode:{type:t.TEXT,allowNull:!0},status:{type:t.INTEGER,allowNull:!1,defaultValue:0,validate:{isNumeric:!0},comment:"0 - active, 1 - inactive"},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/index.js":
/*!****************************!*\
  !*** ./src/model/index.js ***!
  \****************************/
/*! exports provided: sequelize, default */function(e,t,r){"use strict";r.r(t),r.d(t,"sequelize",function(){return j});var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),a=r.n(n),s=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),i=r.n(s),u=r(/*! sequelize */"sequelize"),o=r.n(u),c=r(/*! ../config */"./src/config/index.js"),l=r(/*! ./activation */"./src/model/activation.js"),d=r(/*! ./user */"./src/model/user.js"),f=r(/*! ./user_login */"./src/model/user_login.js"),p=r(/*! ./event */"./src/model/event.js"),m=r(/*! ./comment */"./src/model/comment.js"),h=r(/*! ./reaction */"./src/model/reaction.js"),v=r(/*! ./ticket */"./src/model/ticket.js"),_=r(/*! ./payment_history */"./src/model/payment_history.js"),y=r(/*! ./ticket_purchase */"./src/model/ticket_purchase.js"),b=r(/*! ./relation */"./src/model/relation.js"),g=r(/*! ./market */"./src/model/market.js"),k=r(/*! ./notification_token */"./src/model/notification_token.js"),w=r(/*! ./notification */"./src/model/notification.js"),x=r(/*! ./social_user */"./src/model/social_user.js"),E=r(/*! ./attend */"./src/model/attend.js"),N=r(/*! ./community */"./src/model/community.js"),j=new o.a(c.default.db_name,c.default.db_user,c.default.db_pass,{host:c.default.db_host,port:c.default.db_port,dialect:c.default.db_dialect,pool:{max:20,min:0,idle:1e4},logging:!1}),T={};T.Activation=Object(l.default)(j,o.a),T.User=Object(d.default)(j,o.a),T.UserLogin=Object(f.default)(j,o.a),T.Event=Object(p.default)(j,o.a),T.Comment=Object(m.default)(j,o.a),T.Reaction=Object(h.default)(j,o.a),T.Ticket=Object(v.default)(j,o.a),T.PaymentHistory=Object(_.default)(j,o.a),T.TicketPurchase=Object(y.default)(j,o.a),T.Relation=Object(b.default)(j,o.a),T.Market=Object(g.default)(j,o.a),T.NotificationToken=Object(k.default)(j,o.a),T.Notification=Object(w.default)(j,o.a),T.SocialUser=Object(x.default)(j,o.a),T.Attend=Object(E.default)(j,o.a),T.Community=Object(N.default)(j,o.a),T.User.hasMany(T.UserLogin,{foreignKey:"user_id"}),T.UserLogin.belongsTo(T.User,{foreignKey:"user_id"}),T.User.hasMany(T.Comment,{as:"comments",foreignKey:"user_id"}),T.Comment.belongsTo(T.User,{as:"user",foreignKey:"user_id"}),T.User.hasMany(T.Reaction,{as:"reactions",foreignKey:"user_id"}),T.Reaction.belongsTo(T.User,{as:"user",foreignKey:"user_id"}),T.User.hasMany(T.Ticket,{as:"tickets",foreignKey:"user_id"}),T.Ticket.belongsTo(T.User,{as:"owner",foreignKey:"user_id"}),T.User.hasMany(T.TicketPurchase,{as:"purchase_histories",foreignKey:"user_id"}),T.TicketPurchase.belongsTo(T.User,{as:"buyer",foreignKey:"user_id"}),T.User.hasMany(T.Market,{as:"user_tickets",foreignKey:"user_id"}),T.Market.belongsTo(T.User,{as:"owner",foreignKey:"user_id"}),T.User.hasOne(T.NotificationToken,{as:"my_notification_token",foreignKey:"user_id"}),T.NotificationToken.belongsTo(T.User,{as:"user",foreignKey:"user_id"}),T.User.hasMany(T.Notification,{as:"my_notifications",foreignKey:"user_id"}),T.Notification.belongsTo(T.User,{as:"user",foreignKey:"user_id"}),T.User.hasMany(T.PaymentHistory,{as:"payment_historys",foreignKey:"user_id"}),T.PaymentHistory.belongsTo(T.User,{as:"user",foreignKey:"user_id"}),T.User.hasMany(T.PaymentHistory,{as:"payment_related_historys",foreignKey:"related_user_id"}),T.PaymentHistory.belongsTo(T.User,{as:"related_user",foreignKey:"related_user_id"}),T.User.hasMany(T.Event,{as:"events",foreignKey:"user_id"}),T.Event.belongsTo(T.User,{as:"creator",foreignKey:"user_id"}),T.Event.hasMany(T.Comment,{as:"comments",foreignKey:"relation_id"}),T.Comment.belongsTo(T.Event,{foreignKey:"relation_id"}),T.Event.hasMany(T.Reaction,{as:"likes",foreignKey:"relation_id",constraints:!1}),T.Event.hasMany(T.Reaction,{as:"dislikes",foreignKey:"relation_id",constraints:!1}),T.Reaction.belongsTo(T.Event,{foreignKey:"relation_id",constraints:!1}),T.Event.hasMany(T.Ticket,{as:"tickets",foreignKey:"event_id"}),T.Ticket.belongsTo(T.Event,{as:"eventinfo",foreignKey:"event_id"}),T.Event.hasMany(T.TicketPurchase,{as:"purchase_histories",foreignKey:"event_id"}),T.TicketPurchase.belongsTo(T.Event,{as:"eventinfo",foreignKey:"event_id"}),T.User.hasMany(T.Relation,{as:"followers",foreignKey:"user_id"}),T.Relation.belongsTo(T.User,{as:"user_info",foreignKey:"user_id"}),T.User.hasMany(T.Relation,{as:"following",foreignKey:"follower_id"}),T.Relation.belongsTo(T.User,{as:"follower",foreignKey:"follower_id"}),T.Ticket.hasMany(T.Market,{as:"on_market",foreignKey:"ticket_id"}),T.Market.belongsTo(T.Ticket,{as:"ticket_info",foreignKey:"ticket_id"}),T.Event.hasMany(T.Attend,{as:"attenders",foreignKey:"event_id"}),T.Attend.belongsTo(T.Event,{as:"event_info",foreignKey:"event_id"}),T.Community.hasMany(T.Comment,{as:"comments",foreignKey:"relation_id"}),T.Comment.belongsTo(T.Community,{foreignKey:"relation_id"}),T.transaction=function(){var t=i()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.transaction(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),Object.keys(T).forEach(function(e){"associate"in T[e]&&T[e].associate(T)}),t.default=T},"./src/model/market.js":
/*!*****************************!*\
  !*** ./src/model/market.js ***!
  \*****************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("market",{user_id:{type:t.INTEGER,allowNull:!1,validate:{notEmpty:!0}},ticket_id:{type:t.INTEGER,allowNull:!1,validate:{notEmpty:!0}},amount:{type:t.INTEGER,allowNull:!1,validate:{notEmpty:!0}},price:{type:t.FLOAT,allowNull:!1,validate:{notEmpty:!0}},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/notification.js":
/*!***********************************!*\
  !*** ./src/model/notification.js ***!
  \***********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("notification",{user_id:{type:t.INTEGER,allowNull:!1,validate:{notEmpty:!0}},title:{type:t.TEXT,allowNull:!1,validate:{notEmpty:!0}},content:{type:t.TEXT,allowNull:!1,validate:{notEmpty:!0}},read:{type:t.INTEGER,allowNull:!1,default:0,comment:"0 - unread, 1 - read",validate:{notEmpty:!0}},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/notification_token.js":
/*!*****************************************!*\
  !*** ./src/model/notification_token.js ***!
  \*****************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("notification_token",{user_id:{type:t.INTEGER,allowNull:!1,validate:{notEmpty:!0}},token:{type:t.TEXT,allowNull:!1,validate:{notEmpty:!0}},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/payment_history.js":
/*!**************************************!*\
  !*** ./src/model/payment_history.js ***!
  \**************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("payment_history",{user_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},related_user_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},amount:{type:t.FLOAT,allowNull:!1,default:0,validate:{isNumeric:!0}},type:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0},default:0,comment:"0 - in, 1 - out"},description:{type:t.TEXT,allowNull:!0},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/reaction.js":
/*!*******************************!*\
  !*** ./src/model/reaction.js ***!
  \*******************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("reaction",{type:{type:t.INTEGER,allowNull:!1,defaultValue:0,comment:"0 - event, 1 - comment",validate:{isNumeric:!0}},relation_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},user_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},value:{type:t.INTEGER,allowNull:!1,defaultValue:0,comment:"0 - none, 1 - like, 2 - dislike",validate:{isNumeric:!0}},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/relation.js":
/*!*******************************!*\
  !*** ./src/model/relation.js ***!
  \*******************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("relation",{user_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},follower_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/social_user.js":
/*!**********************************!*\
  !*** ./src/model/social_user.js ***!
  \**********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("socialuser",{user_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},type:{type:t.INTEGER,allowNull:!1,comment:"0 - google, 1-fb, 2-apple",validate:{isNumeric:!0}},social_id:{type:t.TEXT,allowNull:!1},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/ticket.js":
/*!*****************************!*\
  !*** ./src/model/ticket.js ***!
  \*****************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("ticket",{event_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},user_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},amount:{type:t.INTEGER,allowNull:!1,default:1,validate:{isNumeric:!0}},price:{type:t.FLOAT,allowNull:!1,default:0,validate:{notEmpty:!0}},status:{type:t.INTEGER,allowNull:!1,defaultValue:0,comment:"0 - active, 1 - deleted",validate:{isNumeric:!0}},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/ticket_purchase.js":
/*!**************************************!*\
  !*** ./src/model/ticket_purchase.js ***!
  \**************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default=function(e,t){return e.define("ticket_purchase",{event_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},user_id:{type:t.INTEGER,allowNull:!1,validate:{isNumeric:!0}},amount:{type:t.INTEGER,allowNull:!1,default:1,validate:{isNumeric:!0}},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}})}},"./src/model/user.js":
/*!***************************!*\
  !*** ./src/model/user.js ***!
  \***************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);function s(e){var t=c.a.genSaltSync(10);return{hash:c.a.hashSync(e,t),salt:t}}var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),a=r.n(n),i=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),u=r.n(i),o=r(/*! bcryptjs */"bcryptjs"),c=r.n(o);t.default=function(e,t){var n=e.define("user",{email:{type:t.STRING,unique:!0,validate:{isEmail:!0}},first_name:{type:t.STRING,allowNull:!1,validate:{notEmpty:!0}},last_name:{type:t.STRING,allowNull:!1,validate:{notEmpty:!0}},password:{type:t.STRING,allowNull:!1,validate:{notEmpty:!0,len:[6,200]}},photo:{type:t.STRING,allowNull:!0},country_code:{type:t.STRING,allowNull:!0},phonenumber:{type:t.STRING,allowNull:!0},gender:{type:t.INTEGER,allowNull:!0,default:0,comment:"0 - male, 1 - female"},age_range:{type:t.INTEGER,allowNull:!0,default:0,comment:"0 - 10~20, 1 - 20~30, 2 - 30~40 3 - above"},address:{type:t.STRING,allowNull:!0},preferences:{type:t.TEXT,allowNull:!0},cash:{type:t.FLOAT,allowNull:!0,validate:{isNumeric:!0},defaultValue:0},salt:{type:t.STRING},status:{type:t.INTEGER,allowNull:!1,defaultValue:0,validate:{isNumeric:!0},comment:"0 - created, 1 - active, 2 - blocked, 3 - delete"},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}});return n.findByLogin=function(){var t=u()(a.a.mark(function e(t){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.findOne({where:{email:t}});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),n.beforeCreate(function(e,t){var r=s(e.password),n=r.hash,a=r.salt;e.password=n,e.salt=a}),n.beforeBulkUpdate(function(e,t){var r,n,a;e.attributes&&e.attributes.password&&(n=(r=s(e.attributes.password)).hash,a=r.salt,e.attributes.password=n,e.attributes.salt=a)}),n.prototype.validatePassword=function(e){return c.a.compare(e,this.password)},n}},"./src/model/user_login.js":
/*!*********************************!*\
  !*** ./src/model/user_login.js ***!
  \*********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/helpers/defineProperty */"@babel/runtime/helpers/defineProperty"),a=r.n(n),s=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),i=r.n(s),u=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),o=r.n(u),c=r(/*! sequelize */"sequelize"),l=r.n(c),d=r(/*! ../middleware/logger */"./src/middleware/logger/index.js"),f=l.a.Op;t.default=function(e,t){var r=e.define("user_login",{user_id:{type:t.INTEGER,allowNull:!1,validate:{notEmpty:!0}},login_type:{type:t.INTEGER,allowNull:!1,defaultValue:0,validate:{isNumeric:!0},comment:"0 - web, 1 - mobile"},refresh_token:{type:t.TEXT,allowNull:!1,validate:{notEmpty:!0}},lifetime:{type:t.BIGINT},login:t.DATE,refresh:t.DATE,logout:t.DATE,status:{type:t.INTEGER,allowNull:!1,defaultValue:0,validate:{isNumeric:!0},comment:"0 - login, 1 - refresh, 2 - timeout, 3 - logout"},createdAt:{field:"create_date",type:t.DATE,defaultValue:t.NOW},updatedAt:{field:"update_date",type:t.DATE,defaultValue:t.NOW}});return r.beforeCreate(function(){var t=o()(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.expireOldLogins(t.user_id);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),d.default.error("Error on expiring old refresh tokens: ".concat(e.t0));case 8:t.login=(new Date).toLocaleString();case 9:case"end":return e.stop()}},e,null,[[0,5]])}));return function(e){return t.apply(this,arguments)}}()),r.expireOldLogins=function(){var t=o()(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.update({logout:(new Date).toLocaleString(),status:3},{where:{user_id:t,status:a()({},f.lt,2)}});case 2:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),r}},"./src/router/admin/index.js":
/*!***********************************!*\
  !*** ./src/router/admin/index.js ***!
  \***********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);r(/*! passport */"passport");t.default=function(e){}},"./src/router/front/auth.js":
/*!**********************************!*\
  !*** ./src/router/front/auth.js ***!
  \**********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),C=r.n(n),a=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),s=r.n(a),i=r(/*! express */"express"),u=r(/*! passport */"passport"),o=r.n(u),c=r(/*! jsonwebtoken */"jsonwebtoken"),E=r.n(c),l=r(/*! @hapi/joi */"@hapi/joi"),q=r.n(l),D=r(/*! ../../model */"./src/model/index.js"),U=r(/*! ../../middleware/logger */"./src/middleware/logger/index.js"),P=r(/*! ../../config */"./src/config/index.js"),d=r(/*! ../../middleware/mailer */"./src/middleware/mailer/index.js"),N=r(/*! ../../middleware/graph */"./src/middleware/graph/index.js"),f=r(/*! ../../utils */"./src/utils.js"),p=Object(i.Router)(),G=function(){var r=s()(C.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p,m,h;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,a=t.first_name,s=t.last_name,i=t.email,u=t.status,o=t.photo,c=t.country_code,l=t.phonenumber,d=t.gender,f=t.age_range,p=t.address,m=t.preferences,h=t.cash,e.next=3,E.a.sign({id:n,first_name:a,last_name:s,email:i,status:u,photo:o,country_code:c,phonenumber:l,gender:d,age_range:f,address:p,preferences:m,cash:h},P.default.secret_key,{});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(e,t){return r.apply(this,arguments)}}(),j=function(){var t=s()(C.a.mark(function e(t){var r,n,a,s,i;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,n=t.first_name,a=t.last_name,s=t.email,(i={}).user_id=r,i.code=f.generateCode(P.default.activation_code_digit),e.next=6,E.a.sign({activation_code:i.code,email:s,time:(new Date).getTime()},P.default.secret_key,{expiresIn:P.default.activation_code_expiresin});case 6:return i.hash=e.sent,i.link="".concat(P.default.web_root_url).concat(P.default.activation_link_url,"?hval=").concat(i.hash),e.prev=8,e.next=11,D.default.Activation.create(i);case 11:return e.next=13,d.default.sendConfirmationEmail({first_name:n,last_name:a,email:s,activation_code:i.code,activation_link:i.link});case 13:e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(8),U.default.error("Error on sending activation code:",e.t0),e.t0;case 19:case"end":return e.stop()}},e,null,[[8,15]])}));return function(e){return t.apply(this,arguments)}}(),m=function(){var t=s()(C.a.mark(function e(t){var r,n,a,s,i;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,n=t.first_name,a=t.last_name,s=t.email,(i={}).user_id=r,i.code=f.generateCode(P.default.activation_code_digit),e.next=6,E.a.sign({activation_code:i.code,email:s,time:(new Date).getTime()},P.default.secret_key,{expiresIn:P.default.activation_code_expiresin});case 6:return i.hash=e.sent,i.link="".concat(P.default.web_root_url).concat(P.default.reset_password_link_url,"?hval=").concat(i.hash),e.prev=8,e.next=11,D.default.Activation.create(i);case 11:return e.next=13,d.default.sendResetPasswordMail({first_name:n,last_name:a,email:s,activation_code:i.code,activation_link:i.link});case 13:e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(8),U.default.error("Error on sending activation code:",e.t0),e.t0;case 19:case"end":return e.stop()}},e,null,[[8,15]])}));return function(e){return t.apply(this,arguments)}}(),T=function(){var t=s()(C.a.mark(function e(t){var r,n;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Date(t.createdAt),n=(new Date).getTime()-r.getTime(),0===t.status&&n/1e3<P.default.activation_code_expiresin)return e.abrupt("return",!0);e.next=5;break;case 5:return e.next=7,D.default.Activation.update({status:2},{where:{id:t.id}});case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),O=function(){var r=s()(C.a.mark(function e(t,r){var n;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,D.default.transaction();case 3:return n=e.sent,e.next=6,D.default.User.update({status:1},{where:{id:t.id},transaction:n});case 6:return e.next=8,D.default.Activation.update({status:1},{where:{id:r.id},transaction:n});case 8:return e.next=10,n.commit();case 10:e.next=19;break;case 12:if(e.prev=12,e.t0=e.catch(0),U.default.error("Error on active user:",e.t0),n)return e.next=18,n.rollback();e.next=18;break;case 18:throw e.t0;case 19:case"end":return e.stop()}},e,null,[[0,12]])}));return function(e,t){return r.apply(this,arguments)}}();p.post("/login",o.a.authenticate("local",{failWithError:!0}),function(){var r=s()(C.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p,m,h,v,_,y,b,g,k,w,x,E,N,j,T,O,A,R,q,I,S;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,2<=t.user.status)return e.abrupt("return",r.status(401).send({errors:[{message:"This account is blocked, please contact to support."}]}));e.next=5;break;case 5:if(t.user.status<1)return n=t.user,a=n.id,s=n.first_name,i=n.last_name,u=n.email,o=n.photo,c=n.status,l=n.country_code,d=n.phonenumber,f=n.gender,p=n.age_range,m=n.address,h=n.preferences,v=n.cash,e.abrupt("return",r.status(401).send({data:{user:{id:a,first_name:s,last_name:i,email:u,photo:o,status:c,country_code:l,phonenumber:d,gender:f,age_range:p,address:m,preferences:h,cash:v}},errors:[{message:"This account isn't active. Please check our confirm email in your mailbox or resend."}]}));e.next=8;break;case 8:return _=t.body.login_type,y=t.user,b=y.id,g=y.first_name,k=y.last_name,w=y.email,x=y.photo,E=y.status,N=y.country_code,j=y.phonenumber,T=y.gender,O=y.age_range,A=y.address,R=y.preferences,q=y.cash,e.next=12,G(t.user,P.default.token_expiresin);case 12:return I=e.sent,e.next=15,G(t.user,P.default.refresh_token_expiresin);case 15:return S=e.sent,e.next=18,D.default.UserLogin.create({user_id:b,refresh_token:S,login_type:_});case 18:r.status(200).send({data:{user:{id:b,first_name:g,last_name:k,email:w,photo:x,status:E,country_code:N,phonenumber:j,gender:T,age_range:O,address:A,preferences:R,cash:q},token:I,refresh_token:S}}),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(0),U.default.error("Error on login:",e.t0),r.status(500).send({errors:[e.t0]});case 25:case"end":return e.stop()}},e,null,[[0,21]])}));return function(e,t){return r.apply(this,arguments)}}()),p.post("/signup",function(){var r=s()(C.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p,m,h,v,_,y,b,g,k,w,x,E;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body,a=n.email,s=n.first_name,i=n.last_name,u=n.password,o=n.login_type,c=q.a.object().keys({first_name:q.a.string().required(),last_name:q.a.string().required(),password:q.a.string().min(3).max(30).required(),email:q.a.string().email({minDomainSegments:2}).min(3).max(30).required(),login_type:q.a.number().required()}),e.prev=2,q.a.assert({email:a,first_name:s,last_name:i,password:u,login_type:o},c,{abortEarly:!1}),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),l=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:l}));case 10:return e.prev=10,e.next=13,D.default.User.findOne({where:{email:a}});case 13:if(e.sent)return e.abrupt("return",r.status(403).send({errors:[{message:"Email already exists"}]}));e.next=16;break;case 16:return e.next=18,D.default.User.create({first_name:s,last_name:i,password:u,email:a,status:0,photo:P.default.default_avatar});case 18:return d=e.sent,f=d.get({plain:!0}),e.next=22,G(f,P.default.token_expiresin);case 22:return p=e.sent,e.next=25,G(f,P.default.refresh_token_expiresin);case 25:return m=e.sent,h=f.id,v=f.photo,_=f.status,y=f.country_code,b=f.phonenumber,g=f.gender,k=f.age_range,w=f.address,x=f.preferences,E=f.cash,e.next=29,D.default.UserLogin.create({user_id:h,refresh_token:m,login_type:o});case 29:j(f),r.status(200).send({data:{user:{id:h,email:a,first_name:s,last_name:i,photo:v,status:_,country_code:y,phonenumber:b,gender:g,age_range:k,address:w,preferences:x,cash:E},token:p,refresh_token:m}}),e.next=37;break;case 33:e.prev=33,e.t1=e.catch(10),U.default.error("Error on signup:",e.t1),r.status(500).send({errors:[e.t1]});case 37:case"end":return e.stop()}},e,null,[[2,6],[10,33]])}));return function(e,t){return r.apply(this,arguments)}}()),p.post("/request_activation",function(){var r=s()(C.a.mark(function e(t,r){var n,a,s,i;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body.email,a=q.a.object().keys({email:q.a.string().email({minDomainSegments:2}).min(3).max(30).required()}),e.prev=2,q.a.assert({email:n},a,{abortEarly:!1}),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),s=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:s}));case 10:return e.prev=10,e.next=13,D.default.User.findOne({where:{email:n}});case 13:if(i=e.sent){e.next=16;break}return e.abrupt("return",r.status(403).send({errors:[{message:"Your email isn't registered"}]}));case 16:if(0!=i.status)return e.abrupt("return",r.status(403).send({errors:[{message:"Your account is already activated. Please try to login."}]}));e.next=18;break;case 18:j(i),r.status(200).send({data:{message:"Activation code is sent to ".concat(n)}}),e.next=26;break;case 22:e.prev=22,e.t1=e.catch(10),U.default.error("Error on requesting activation code:",e.t1),r.status(500).send({errors:[e.t1]});case 26:case"end":return e.stop()}},e,null,[[2,6],[10,22]])}));return function(e,t){return r.apply(this,arguments)}}()),p.post("/activate",function(){var r=s()(C.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p,m,h,v,_,y,b,g,k,w,x,E;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body,a=n.email,s=n.code,i=n.login_type,u=q.a.object().keys({email:q.a.string().email({minDomainSegments:2}).min(3).max(30).required(),code:q.a.string().min(6).max(10).required(),login_type:q.a.number().required()}),e.prev=2,q.a.assert({email:a,code:s,login_type:i},u,{abortEarly:!1}),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),o=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:o}));case 10:return e.prev=10,e.next=13,D.default.User.findOne({where:{email:a}});case 13:if(c=e.sent){e.next=16;break}return e.abrupt("return",r.status(403).send({errors:[{message:"Your email isn't registered"}]}));case 16:if(1==c.status)return e.abrupt("return",r.status(403).send({errors:[{message:"Your account is already activated."}]}));e.next=20;break;case 20:if(0!=c.status)return e.abrupt("return",r.status(403).send({errors:[{message:"Unable to active this account. Please contact to support."}]}));e.next=22;break;case 22:return e.next=24,D.default.Activation.findOne({where:{user_id:c.id,code:s},order:[["create_date","DESC"]]});case 24:if(l=e.sent){e.next=27;break}return e.abrupt("return",r.status(403).send({errors:[{message:"Activation code is incorrect"}]}));case 27:return e.next=29,T(l);case 29:if(e.sent){e.next=32;break}return e.abrupt("return",r.status(403).send({errors:[{message:"Activation data is expired. Please request activation again."}]}));case 32:return e.next=34,O(c,l);case 34:return N.default.addUser(c.get({plain:!0})),e.next=37,G(c,P.default.token_expiresin);case 37:return d=e.sent,e.next=40,G(c,P.default.refresh_token_expiresin);case 40:return f=e.sent,p=c.id,m=c.first_name,h=c.last_name,v=c.photo,_=c.status,y=c.country_code,b=c.phonenumber,g=c.gender,k=c.age_range,w=c.address,x=c.preferences,E=c.cash,e.next=44,D.default.UserLogin.create({user_id:p,refresh_token:f,login_type:i});case 44:r.status(200).send({data:{user:{id:p,first_name:m,last_name:h,email:a,photo:v,status:_,country_code:y,phonenumber:b,gender:g,age_range:k,address:w,preferences:x,cash:E},token:d,refresh_token:f}}),e.next=51;break;case 47:e.prev=47,e.t1=e.catch(10),U.default.error("Error on activate user:",e.t1),r.status(500).send({errors:[e.t1]});case 51:case"end":return e.stop()}},e,null,[[2,6],[10,47]])}));return function(e,t){return r.apply(this,arguments)}}()),p.post("/request_reset_password",function(){var r=s()(C.a.mark(function e(t,r){var n,a,s,i;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body.email,a=q.a.object().keys({email:q.a.string().email({minDomainSegments:2}).min(3).max(30).required()}),e.prev=2,q.a.assert({email:n},a,{abortEarly:!1}),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),s=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:s}));case 10:return e.prev=10,e.next=13,D.default.User.findOne({where:{email:n}});case 13:if(i=e.sent){e.next=16;break}return e.abrupt("return",r.status(403).send({errors:[{message:"Your email isn't registered"}]}));case 16:if(0==i.status)return e.abrupt("return",r.status(403).send({errors:[{message:"Your account isn't activated. Please activate that first"}]}));e.next=20;break;case 20:if(1!=i.status)return e.abrupt("return",r.status(403).send({errors:[{message:"Your account has a problem. Please contact to support."}]}));e.next=22;break;case 22:m(i),r.status(200).send({data:{message:"Reset password email is sent to ".concat(n)}}),e.next=30;break;case 26:e.prev=26,e.t1=e.catch(10),U.default.error("Error on requesting reset password:",e.t1),r.status(500).send({errors:[e.t1]});case 30:case"end":return e.stop()}},e,null,[[2,6],[10,26]])}));return function(e,t){return r.apply(this,arguments)}}()),p.post("/reset_password",function(){var r=s()(C.a.mark(function e(t,r){var n,a,s,i,u,o,c,l;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body,a=n.email,s=n.code,i=n.password,u=q.a.object().keys({email:q.a.string().email({minDomainSegments:2}).min(3).max(30).required(),code:q.a.string().min(6).max(10).required(),password:q.a.string().min(3).max(30).required()}),e.prev=2,q.a.assert({email:a,code:s,password:i},u,{abortEarly:!1}),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),o=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:o}));case 10:return e.prev=10,e.next=13,D.default.User.findOne({where:{email:a}});case 13:if(c=e.sent){e.next=16;break}return e.abrupt("return",r.status(403).send({errors:[{message:"Your email isn't registered"}]}));case 16:if(0==c.status)return e.abrupt("return",r.status(403).send({errors:[{message:"Your account isn't activated. Please activate that first"}]}));e.next=20;break;case 20:if(1!=c.status)return e.abrupt("return",r.status(403).send({errors:[{message:"Your account has a problem. Please contact to support."}]}));e.next=22;break;case 22:return e.next=24,D.default.Activation.findOne({where:{user_id:c.id,code:s},order:[["create_date","DESC"]]});case 24:if(l=e.sent){e.next=27;break}return e.abrupt("return",r.status(403).send({errors:[{message:"Code is incorrect"}]}));case 27:return e.next=29,T(l);case 29:if(e.sent){e.next=32;break}return e.abrupt("return",r.status(403).send({errors:[{message:"Code is expired. Please request again."}]}));case 32:return e.next=34,D.default.User.update({password:i},{where:{id:c.id}});case 34:r.status(200).send({data:{message:"Password is changed successfully"}}),e.next=41;break;case 37:e.prev=37,e.t1=e.catch(10),U.default.error("Error on reset password:",e.t1),r.status(500).send({errors:[e.t1]});case 41:case"end":return e.stop()}},e,null,[[2,6],[10,37]])}));return function(e,t){return r.apply(this,arguments)}}()),p.post("/token",function(){var r=s()(C.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p,m,h,v,_,y,b,g,k,w,x;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body.refresh_token,a=q.a.object().keys({refresh_token:q.a.string().required()}),e.prev=2,q.a.assert({refresh_token:n},a,{abortEarly:!1}),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),s=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:s}));case 10:return e.prev=10,i=E.a.verify(n,P.default.secret_key,{ignoreExpiration:!0}),e.next=14,D.default.User.findByPk(i.id);case 14:return u=e.sent,e.next=17,D.default.UserLogin.findOne({where:{user_id:u.id,refresh_token:n}});case 17:if(o=e.sent){e.next=22;break}return e.abrupt("return",r.status(403).send({errors:[{message:"No account found with this refresh token: ".concat(n)}]}));case 22:if(1<o.status)return e.abrupt("return",r.status(403).send({errors:[{message:"refresh token invalid"}]}));e.next=24;break;case 24:if(i.exp<=Math.floor(Date.now()/1e3))return e.next=27,o.update({logout:(new Date).toLocaleString(),status:2});e.next=28;break;case 27:return e.abrupt("return",r.status(401).send({errors:[{message:"refresh token expired"}]}));case 28:return e.next=30,G(u,P.default.token_expiresin);case 30:return c=e.sent,e.next=33,G(u,P.default.refresh_token_expiresin);case 33:return l=e.sent,e.next=36,o.update({refresh_token:l,refresh:(new Date).toLocaleString(),status:1});case 36:d=u.id,f=u.first_name,p=u.last_name,m=u.email,h=u.photo,v=u.status,_=u.country_code,y=u.phonenumber,b=u.gender,g=u.age_range,k=u.address,w=u.preferences,x=u.cash,r.status(200).send({data:{user:{id:d,first_name:f,last_name:p,email:m,photo:h,status:v,country_code:_,phonenumber:y,gender:b,age_range:g,address:k,preferences:w,cash:x},token:c,refresh_token:l}}),e.next=44;break;case 40:e.prev=40,e.t1=e.catch(10),U.default.error("Error on update token:",e.t1),r.status(500).send({errors:[e.t1]});case 44:case"end":return e.stop()}},e,null,[[2,6],[10,40]])}));return function(e,t){return r.apply(this,arguments)}}()),p.post("/logout",o.a.authenticate("jwt",{failWithError:!0,session:!1}),function(){var r=s()(C.a.mark(function e(t,r){var n,a,s,i,u;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body.refresh_token,a=q.a.object().keys({refresh_token:q.a.string().required()}),e.prev=2,q.a.assert({refresh_token:n},a,{abortEarly:!1}),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),s=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:s}));case 10:return e.prev=10,i=t.user.id,e.next=14,D.default.UserLogin.findOne({where:{user_id:i,refresh_token:n}});case 14:if(u=e.sent){e.next=17;break}return e.abrupt("return",r.status(403).send({errors:[{message:"No account found with this refresh token: ".concat(n)}]}));case 17:return e.next=19,u.update({status:3});case 19:t.logout(),r.status(200).send({data:"Success"}),e.next=27;break;case 23:e.prev=23,e.t1=e.catch(10),U.default.error("Error on logout:",e.t1),r.status(500).send({errors:[e.t1]});case 27:case"end":return e.stop()}},e,null,[[2,6],[10,23]])}));return function(e,t){return r.apply(this,arguments)}}()),p.post("/social",function(){var r=s()(C.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p,m,h,v,_,y,b,g,k,w,x,E,N,j,T,O,A,R;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body,a=n.type,s=n.social_id,i=n.email,u=n.first_name,n.last_name,n.photo,o=n.login_type,c=q.a.object().keys({type:q.a.number().required(),email:q.a.string().required(),first_name:q.a.string().required(),login_type:q.a.number().required()}),e.prev=2,q.a.assert({type:a,email:i,first_name:u,login_type:o},c,{abortEarly:!1}),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),l=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:l}));case 10:return e.prev=10,d={},e.next=14,D.default.SocialUser.findOne({where:{type:a,social_id:s}});case 14:if(f=e.sent,p=0,f)return e.next=19,D.default.User.findOne({where:{id:f.user_id}});e.next=25;break;case 19:if(2<=(d=e.sent).status)return e.abrupt("return",r.status(401).send({errors:[{message:"This account is blocked, please contact to support."}]}));e.next=22;break;case 22:p=d.id,e.next=38;break;case 25:if(k&&0<k.length)return e.next=28,D.default.User.findOne({where:{email:k}});e.next=30;break;case 28:(m=e.sent)&&(p=(d=m).id);case 30:if(0===p)return e.next=33,D.default.User.create({first_name:t.body.first_name,last_name:t.body.last_name,password:Math.random().toString(36).slice(-8),email:t.body.email,status:1,photo:t.body.photo||P.default.default_avatar});e.next=36;break;case 33:h=e.sent,d=h.get({plain:!0}),p=d.id;case 36:return e.next=38,D.default.SocialUser.create({user_id:p,social_id:s,type:a});case 38:return e.next=40,G(d,P.default.token_expiresin);case 40:return v=e.sent,e.next=43,G(d,P.default.refresh_token_expiresin);case 43:return _=e.sent,e.next=46,D.default.UserLogin.create({user_id:p,refresh_token:_,login_type:o});case 46:y=d.id,b=d.first_name,g=d.last_name,k=d.email,w=d.photo,x=d.status,E=d.country_code,N=d.phonenumber,j=d.gender,T=d.age_range,O=d.address,A=d.preferences,R=d.cash,r.status(200).send({data:{user:{id:y,first_name:b,last_name:g,email:k,photo:w,status:x,country_code:E,phonenumber:N,gender:j,age_range:T,address:O,preferences:A,cash:R},token:v,refresh_token:_}}),e.next=54;break;case 50:e.prev=50,e.t1=e.catch(10),U.default.error("Error on update token:",e.t1),r.status(500).send({errors:[e.t1]});case 54:case"end":return e.stop()}},e,null,[[2,6],[10,50]])}));return function(e,t){return r.apply(this,arguments)}}()),t.default=p},"./src/router/front/comment.js":
/*!*************************************!*\
  !*** ./src/router/front/comment.js ***!
  \*************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),b=r.n(n),a=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),s=r.n(a),i=r(/*! express */"express"),u=r(/*! @hapi/joi */"@hapi/joi"),g=r.n(u),k=r(/*! ../../model */"./src/model/index.js"),w=r(/*! ../../middleware/logger */"./src/middleware/logger/index.js"),x=r(/*! ../../middleware/graph */"./src/middleware/graph/index.js"),o=Object(i.Router)();o.post("/:comment_id",function(){var r=s()(b.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p,m,h,v,_,y;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.params.comment_id,a=t.body,s=a.relation_id,i=a.type,u=a.text,o=t.user,c=o.id,l=o.photo,d=o.first_name,f=o.last_name,p=g.a.object().keys({relation_id:g.a.number().required(),type:g.a.number().required(),text:g.a.string().required()}),e.prev=4,g.a.assert({relation_id:s,type:i,text:u},p,{abortEarly:!1}),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(4),m=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:m}));case 12:if(e.prev=12,h={},0===parseInt(n,10))return e.next=17,k.default.Comment.create({user_id:c,relation_id:s,type:i,text:u});e.next=22;break;case 17:v=e.sent,h=v.get({plain:!0}),x.default.addComment(h),e.next=27;break;case 22:return e.next=24,k.default.Comment.update({text:u},{where:{id:n}});case 24:return e.next=26,k.default.Comment.findByPk(n);case 26:h=e.sent;case 27:_=h.createdAt,y=h.updatedAt,r.status(200).send({data:{comment:{id:h.id,relation_id:s,type:i,text:u,createdAt:_,updatedAt:y,user:{id:c,photo:l,first_name:d,last_name:f}}}}),e.next=35;break;case 31:e.prev=31,e.t1=e.catch(12),w.default.error("Error on leaving comment:",e.t1),r.status(500).send({errors:[e.t1]});case 35:case"end":return e.stop()}},e,null,[[4,8],[12,31]])}));return function(e,t){return r.apply(this,arguments)}}()),o.post("/delete/:comment_id",function(){var r=s()(b.a.mark(function e(t,r){var n;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.comment_id,e.prev=1,e.next=4,k.default.Comment.destroy({where:{id:n}});case 4:x.default.addComment(comment),r.status(200).send({data:{msg:"success"}}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),w.default.error("Error on deleting comment:",e.t0),r.status(500).send({errors:[e.t0]});case 12:case"end":return e.stop()}},e,null,[[1,8]])}));return function(e,t){return r.apply(this,arguments)}}()),t.default=o},"./src/router/front/community.js":
/*!***************************************!*\
  !*** ./src/router/front/community.js ***!
  \***************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),f=r.n(n),a=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),s=r.n(a),i=r(/*! express */"express"),u=r(/*! passport */"passport"),o=r.n(u),c=r(/*! @hapi/joi */"@hapi/joi"),p=r.n(c),m=r(/*! ../../model */"./src/model/index.js"),h=r(/*! ../../middleware/logger */"./src/middleware/logger/index.js"),l=r(/*! sequelize */"sequelize"),d=r.n(l),v=Object(i.Router)(),_=(d.a.Op,["id","user_id","title","content","poster","createdAt","updatedAt"]),y=[{model:m.default.Comment,attributes:["id","relation_id","text","user_id","createdAt","updatedAt"],as:"comments",required:!1,where:{type:1},include:[{model:m.default.User,attributes:["id","first_name","last_name","photo"],as:"user"}]}];v.get("/",function(){var r=s()(f.a.mark(function e(t,r){var n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.default.Community.findAll({nest:!0,raw:!1,attributes:_,include:y});case 3:n=e.sent,r.status(200).send({data:n}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),h.default.error("Error on fetching communities:",e.t0),r.status(500).send({errors:[e.t0]});case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(e,t){return r.apply(this,arguments)}}()),v.get("/:id",function(){var r=s()(f.a.mark(function e(t,r){var n,a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.params.id,e.next=4,m.default.Community.findOne({attributes:_,include:y,where:{id:n}});case 4:a=e.sent,r.status(200).send({data:a}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),h.default.error("Error on fetching community:",e.t0),r.status(500).send({errors:[e.t0]});case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(e,t){return r.apply(this,arguments)}}()),v.post("/",o.a.authenticate("jwt",{failWithError:!0,session:!1}),function(){var r=s()(f.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body,a=n.title,s=n.content,i=n.poster,u=t.user.id,o=p.a.object().keys({title:p.a.string().required(),content:p.a.string().required(),poster:p.a.string().required()}),e.prev=3,p.a.assert({title:a,content:s,poster:i},o,{abortEarly:!1}),e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(3),c=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:c}));case 11:return e.prev=11,e.next=14,m.default.Community.create({user_id:u,title:a,content:s,poster:i});case 14:l=e.sent,d=l.get({plain:!0}),r.status(200).send({data:{community:d}}),e.next=23;break;case 19:e.prev=19,e.t1=e.catch(11),h.default.error("Error on creating community:",e.t1),r.status(500).send({errors:[e.t1]});case 23:case"end":return e.stop()}},e,null,[[3,7],[11,19]])}));return function(e,t){return r.apply(this,arguments)}}()),t.default=v},"./src/router/front/event.js":
/*!***********************************!*\
  !*** ./src/router/front/event.js ***!
  \***********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/helpers/defineProperty */"@babel/runtime/helpers/defineProperty"),C=r.n(n),a=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),D=r.n(a),s=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),i=r.n(s),u=r(/*! express */"express"),o=r(/*! passport */"passport"),c=r.n(o),l=r(/*! @hapi/joi */"@hapi/joi"),U=r.n(l),P=r(/*! ../../model */"./src/model/index.js"),G=r(/*! ../../middleware/graph */"./src/middleware/graph/index.js"),M=r(/*! ../../middleware/logger */"./src/middleware/logger/index.js"),d=r(/*! sequelize */"sequelize"),f=r.n(d),L=r(/*! ../../middleware/notification */"./src/middleware/notification/index.js"),p=r(/*! qrcode */"qrcode"),W=r.n(p),K=r(/*! ../../middleware/uploader */"./src/middleware/uploader/index.js"),m=r(/*! moment */"moment"),h=r.n(m);function v(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?v(Object(r),!0).forEach(function(e){C()(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var y=Object(u.Router)(),b=f.a.Op,g=["id","user_id","title","description","content","online_event","location","lat","lng","total_ticket","ticket_limit","poster","start_date","end_date","free_event","price","restriction_age","restriction_dress","restriction_refund","restriction_id","restriction_cash","status","qrcode","createdAt","updatedAt"],k=[{model:P.default.User,as:"creator",attributes:["id","first_name","last_name","photo"]},{model:P.default.Comment,attributes:["id","relation_id","text","user_id","createdAt","updatedAt"],as:"comments",required:!1,where:{type:0},include:[{model:P.default.User,attributes:["id","first_name","last_name","photo"],as:"user"}]},{model:P.default.Reaction,attributes:["user_id"],required:!1,where:{type:0,value:1},as:"likes"},{model:P.default.Reaction,attributes:["user_id"],required:!1,where:{type:0,value:2},as:"dislikes"}];y.get("/public",function(){var r=i()(D.a.mark(function e(t,r){var n;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.default.Event.findAll({nest:!0,raw:!1,attributes:g,include:k});case 3:n=e.sent,r.status(200).send({data:n}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),M.default.error("Error on fetching events:",e.t0),r.status(500).send({errors:[e.t0]});case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(e,t){return r.apply(this,arguments)}}()),y.get("/",c.a.authenticate("jwt",{failWithError:!0,session:!1}),function(){var r=i()(D.a.mark(function e(t,r){var n,a,s;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=G.default.findEvents(t.user.id,"",null,50),a=n.map(function(e){return e.get("id")}),e.next=5,P.default.Event.findAll({nest:!0,raw:!1,attributes:g,include:k,where:{id:C()({},b.in,a)}});case 5:(s=e.sent).sort(function(e,t){return a.indexOf(e.id)-a.indexOf(t.id)}),r.status(200).send({data:s}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),M.default.error("Error on fetching events:",e.t0),r.status(500).send({errors:[e.t0]});case 14:case"end":return e.stop()}},e,null,[[0,10]])}));return function(e,t){return r.apply(this,arguments)}}()),y.get("/detail/:id",function(){var r=i()(D.a.mark(function e(t,r){var n,a;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.params.id,e.next=4,P.default.Event.findOne({attributes:g,include:k,where:{id:n}});case 4:a=e.sent,r.status(200).send({data:a}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),M.default.error("Error on fetching event:",e.t0),r.status(500).send({errors:[e.t0]});case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(e,t){return r.apply(this,arguments)}}()),y.get("/mine",c.a.authenticate("jwt",{failWithError:!0,session:!1}),function(){var r=i()(D.a.mark(function e(t,r){var n,a;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.user.id,e.next=4,P.default.Event.findAll({nest:!0,raw:!1,attributes:g,include:[].concat(k,[{model:P.default.Attend,as:"attenders",required:!1}]),where:{user_id:n}});case 4:a=e.sent,r.status(200).send({data:a}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),M.default.error("Error on fetching my events:",e.t0),r.status(500).send({errors:[e.t0]});case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(e,t){return r.apply(this,arguments)}}()),y.post("/attend",c.a.authenticate("jwt",{failWithError:!0,session:!1}),function(){var r=i()(D.a.mark(function e(t,r){var n,a;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.body.event_id,a=t.user.id,e.next=5,P.default.Attend.findOne({where:{user_id:a,event_id:n}});case 5:if(e.sent)return e.abrupt("return",r.status(200).send({data:{msg:"success"}}));e.next=8;break;case 8:return e.next=10,P.default.Ticket.findOne({where:{user_id:a,event_id:n}});case 10:if(e.sent){e.next=13;break}return e.abrupt("return",r.status(403).send({errors:[{message:"You have no tickets on this event."}]}));case 13:return e.next=15,P.default.Attend.create({user_id:a,event_id:n});case 15:r.status(200).send({data:{msg:"success"}}),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(0),M.default.error("Error on attending event:",e.t0),r.status(500).send({errors:[e.t0]});case 22:case"end":return e.stop()}},e,null,[[0,18]])}));return function(e,t){return r.apply(this,arguments)}}()),y.post("/",c.a.authenticate("jwt",{failWithError:!0,session:!1}),function(){var r=i()(D.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p,m,h,v,_,y,b,g,k,w,x,E,N,j,T,O,A,R,q,I,S;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body,a=n.title,s=n.description,i=n.content,u=n.online_event,o=n.location,c=n.lat,l=n.lng,d=n.start_date,f=n.end_date,p=n.total_ticket,m=n.ticket_limit,h=n.price,v=n.free_event,_=n.poster,y=n.restriction_age,b=n.restriction_dress,g=n.restriction_refund,k=n.restriction_id,w=n.restriction_cash,x=t.user,E=x.id,N=x.first_name,j=x.last_name,T=U.a.object().keys({title:U.a.string().required(),description:U.a.string().required(),content:U.a.string().required(),online_event:U.a.number().min(0).max(1).required(),location:U.a.string().required(),lat:U.a.number().required(),lng:U.a.number().required(),start_date:U.a.date().required(),end_date:U.a.date().required(),total_ticket:U.a.number().min(1).required(),ticket_limit:U.a.number().min(1).max(50).required(),free_event:U.a.number().min(0).max(1).required(),price:U.a.number().required(),poster:U.a.string().required()}),e.prev=3,U.a.assert(C()({title:a,description:s,content:i,online_event:u,location:o,lat:c,lng:l,start_date:d,end_date:f,total_ticket:p,ticket_limit:m,price:h,poster:_,free_event:v},"poster",_),T,{abortEarly:!1}),e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(3),O=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:O}));case 11:return e.prev=11,e.next=14,P.default.Event.create({user_id:E,title:a,description:s,content:i,online_event:u,poster:_,location:1===u?"Online Event":o,lat:c,lng:l,start_date:d,end_date:f,total_ticket:p,ticket_limit:m,free_event:v,price:1===v?0:h,restriction_age:y,restriction_dress:b,restriction_refund:g,restriction_id:k,restriction_cash:w});case 14:return A=e.sent,R=A.get({plain:!0}),q=JSON.stringify({eventree_id:R.id}),e.next=19,W.a.toDataURL(q,{errorCorrectionLevel:"L",width:400,margin:0,scale:1});case 19:return I=e.sent,e.next=22,K.default.upload64({uri:I,name:""});case 22:return S=e.sent,e.next=25,P.default.Event.update({qrcode:S.Location},{where:{id:R.id}});case 25:L.default.sendEventCreateNotification(E,"".concat(N," ").concat(j),a),G.default.addEvent(R),r.status(200).send({data:{event:R}}),e.next=34;break;case 30:e.prev=30,e.t1=e.catch(11),M.default.error("Error on creating event:",e.t1),r.status(500).send({errors:[e.t1]});case 34:case"end":return e.stop()}},e,null,[[3,7],[11,30]])}));return function(e,t){return r.apply(this,arguments)}}()),y.post("/search",c.a.authenticate("jwt",{failWithError:!0,session:!1}),function(){var r=i()(D.a.mark(function e(t,r){var n,a,s,i,u,o;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.body,a=n.search_string,s=n.from,i=n.to,u={start_date:C()({},b.ne,null)},a&&0<a.length&&(u.title=C()({},b.iLike,"%".concat(a,"%"))),s&&0<s.length&&(u.start_date=_(_({},u.start_date),{},C()({},b.gte,h()(s).format("YYYY-MM-DD HH:mm:ss")))),i&&0<i.length&&(u.start_date=_(_({},u.start_date),{},C()({},b.lte,h()(i).format("YYYY-MM-DD HH:mm:ss")))),e.next=8,P.default.Event.findAll({nest:!0,raw:!1,attributes:g,include:k,where:u});case 8:o=e.sent,r.status(200).send({data:o}),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),M.default.error("Error on fetching events:",e.t0),r.status(500).send({errors:[e.t0]});case 16:case"end":return e.stop()}},e,null,[[0,12]])}));return function(e,t){return r.apply(this,arguments)}}()),t.default=y},"./src/router/front/index.js":
/*!***********************************!*\
  !*** ./src/router/front/index.js ***!
  \***********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! passport */"passport"),a=r.n(n),s=r(/*! ./auth */"./src/router/front/auth.js"),i=r(/*! ./event */"./src/router/front/event.js"),u=r(/*! ./comment */"./src/router/front/comment.js"),o=r(/*! ./reaction */"./src/router/front/reaction.js"),c=r(/*! ./profile */"./src/router/front/profile.js"),l=r(/*! ./ticket */"./src/router/front/ticket.js"),d=r(/*! ./payment */"./src/router/front/payment.js"),f=r(/*! ./relation */"./src/router/front/relation.js"),p=r(/*! ./market */"./src/router/front/market.js"),m=r(/*! ./notification */"./src/router/front/notification.js"),h=r(/*! ./user */"./src/router/front/user.js"),v=r(/*! ./community */"./src/router/front/community.js");t.default=function(e){e.use("/auth",s.default),e.use("/event",i.default),e.use("/community",v.default),e.use("/comment",a.a.authenticate("jwt",{failWithError:!0,session:!1}),u.default),e.use("/reaction",a.a.authenticate("jwt",{failWithError:!0,session:!1}),o.default),e.use("/profile",a.a.authenticate("jwt",{failWithError:!0,session:!1}),c.default),e.use("/ticket",a.a.authenticate("jwt",{failWithError:!0,session:!1}),l.default),e.use("/payment",a.a.authenticate("jwt",{failWithError:!0,session:!1}),d.default),e.use("/relation",a.a.authenticate("jwt",{failWithError:!0,session:!1}),f.default),e.use("/market",a.a.authenticate("jwt",{failWithError:!0,session:!1}),p.default),e.use("/notification",a.a.authenticate("jwt",{failWithError:!0,session:!1}),m.default),e.use("/user",a.a.authenticate("jwt",{failWithError:!0,session:!1}),h.default)}},"./src/router/front/market.js":
/*!************************************!*\
  !*** ./src/router/front/market.js ***!
  \************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),m=r.n(n),a=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),s=r.n(a),i=r(/*! express */"express"),u=r(/*! @hapi/joi */"@hapi/joi"),h=r.n(u),v=r(/*! ../../model */"./src/model/index.js"),_=r(/*! ../../middleware/logger */"./src/middleware/logger/index.js"),o=Object(i.Router)(),c=["id","user_id","ticket_id","amount","price","create_date","update_date"],l=[{model:v.default.User,as:"owner",attributes:["id","first_name","last_name","photo"]},{model:v.default.Ticket,as:"ticket_info",include:[{model:v.default.Event,attributes:["id","title","start_date"],as:"eventinfo",required:!1,include:[{model:v.default.User,as:"creator",attributes:["id","first_name","last_name","photo"]}]}]}];o.post("/transfer",function(){var r=s()(m.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.user.id,a=t.body,s=a.amount,i=a.ticket_id,u=a.price,o=h.a.object().keys({amount:h.a.number().required(),ticket_id:h.a.number().required(),price:h.a.number().required()}),e.prev=3,h.a.assert({amount:s,ticket_id:i,price:u},o,{abortEarly:!1}),e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(3),c=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:c}));case 11:return e.prev=11,e.next=14,v.default.Ticket.findByPk(i);case 14:return l=e.sent,e.next=17,v.default.Market.findOne({where:{user_id:n,ticket_id:i}});case 17:if(d=e.sent,f=d?d.amount:0,(p=l.amount-f)<s)return e.abrupt("return",r.status(403).send({errors:[{message:"You can transfer ".concat(p," tickets.")}]}));e.next=22;break;case 22:if(d)return e.next=25,v.default.Market.update({amount:s+d.amount,price:u.toFixed(2)},{where:{id:d.id}});e.next=27;break;case 25:e.next=29;break;case 27:return e.next=29,v.default.Market.create({amount:s,price:u.toFixed(2),ticket_id:i,user_id:n});case 29:r.status(200).send({data:{msg:"success"}}),e.next=36;break;case 32:e.prev=32,e.t1=e.catch(11),_.default.error("Error on transfering to market:",e.t1),r.status(500).send({errors:[e.t1]});case 36:case"end":return e.stop()}},e,null,[[3,7],[11,32]])}));return function(e,t){return r.apply(this,arguments)}}()),o.post("/delete/:market_id",function(){var r=s()(m.a.mark(function e(t,r){var n;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.market_id,e.prev=1,e.next=4,v.default.Market.destroy({where:{id:n}});case 4:r.status(200).send({data:{msg:"success"}}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),_.default.error("Error on deleting market:",e.t0),r.status(500).send({errors:[e.t0]});case 11:case"end":return e.stop()}},e,null,[[1,7]])}));return function(e,t){return r.apply(this,arguments)}}()),o.get("/",function(){var r=s()(m.a.mark(function e(t,r){var n;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.default.Market.findAll({nest:!0,raw:!1,attributes:c,include:l});case 3:n=e.sent,r.status(200).send({data:n}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),_.default.error("Error on fetching market tickets:",e.t0),r.status(500).send({errors:[e.t0]});case 11:case"end":return e.stop()}},e,null,[[0,7]])}));return function(e,t){return r.apply(this,arguments)}}()),t.default=o},"./src/router/front/notification.js":
/*!******************************************!*\
  !*** ./src/router/front/notification.js ***!
  \******************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),i=r.n(n),a=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),s=r.n(a),u=r(/*! express */"express"),o=r(/*! ../../model */"./src/model/index.js"),c=r(/*! ../../middleware/logger */"./src/middleware/logger/index.js"),l=Object(u.Router)();l.get("/",function(){var r=s()(i.a.mark(function e(t,r){var n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.user.id,e.prev=1,e.next=4,o.default.Notification.findAll({nest:!0,raw:!1,where:{user_id:n},order:[["id","DESC"]]});case 4:a=e.sent,r.status(200).send({data:a}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),c.default.error("Error on getting notifications:",e.t0),r.status(500).send({errors:[e.t0]});case 12:case"end":return e.stop()}},e,null,[[1,8]])}));return function(e,t){return r.apply(this,arguments)}}()),l.post("/read/:notification_id",function(){var r=s()(i.a.mark(function e(t,r){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.notification_id,e.prev=1,e.next=4,o.default.Notification.update({read:1},{where:{id:parseInt(n,10)}});case 4:r.status(200).send({data:{msg:"success"}}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),c.default.error("Error on reading notification:",e.t0),r.status(500).send({errors:[e.t0]});case 11:case"end":return e.stop()}},e,null,[[1,7]])}));return function(e,t){return r.apply(this,arguments)}}()),l.post("/token",function(){var r=s()(i.a.mark(function e(t,r){var n,a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.user.id,a=t.body.token,e.prev=2,e.next=5,o.default.NotificationToken.findOne({where:{user_id:n}});case 5:if(s=e.sent){e.next=11;break}return e.next=9,o.default.NotificationToken.create({user_id:n,token:a});case 9:e.next=13;break;case 11:return e.next=13,o.default.NotificationToken.update({token:a},{where:{id:s.id}});case 13:r.status(200).send({data:{msg:"success"}}),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(2),c.default.error("Error on updating notification token:",e.t0),r.status(500).send({errors:[e.t0]});case 20:case"end":return e.stop()}},e,null,[[2,16]])}));return function(e,t){return r.apply(this,arguments)}}()),t.default=l},"./src/router/front/payment.js":
/*!*************************************!*\
  !*** ./src/router/front/payment.js ***!
  \*************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),s=r.n(n),a=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),i=r.n(a),u=r(/*! express */"express"),o=r(/*! ../../model */"./src/model/index.js"),c=r(/*! ../../middleware/logger */"./src/middleware/logger/index.js"),l=r(/*! sequelize */"sequelize"),d=r.n(l),f=Object(u.Router)(),p=(d.a.Op,["id","user_id","related_user_id","amount","type","description","createdAt","updatedAt"]),m=[{model:o.default.User,as:"related_user",attributes:["id","first_name","last_name","photo"]}];f.get("/history",function(){var r=i()(s.a.mark(function e(t,r){var n,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.user.id,e.prev=1,e.next=4,o.default.PaymentHistory.findAll({nest:!0,raw:!1,attributes:p,include:m,where:{user_id:n},order:[["id","DESC"]]});case 4:a=e.sent,r.status(200).send({data:a}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),c.default.error("Error on fetching payment history:",e.t0),r.status(500).send({errors:[e.t0]});case 12:case"end":return e.stop()}},e,null,[[1,8]])}));return function(e,t){return r.apply(this,arguments)}}()),f.get("/cash",function(){var r=i()(s.a.mark(function e(t,r){var n,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.user.id,e.prev=1,e.next=4,o.default.User.findByPk(n);case 4:a=e.sent,r.status(200).send({data:{cash:a.cash}}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),c.default.error("Error on gettinc user cash:",e.t0),r.status(500).send({errors:[e.t0]});case 12:case"end":return e.stop()}},e,null,[[1,8]])}));return function(e,t){return r.apply(this,arguments)}}()),t.default=f},"./src/router/front/profile.js":
/*!*************************************!*\
  !*** ./src/router/front/profile.js ***!
  \*************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),v=r.n(n),a=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),s=r.n(a),i=r(/*! express */"express"),u=r(/*! @hapi/joi */"@hapi/joi"),_=r.n(u),y=r(/*! ../../model */"./src/model/index.js"),b=r(/*! ../../middleware/logger */"./src/middleware/logger/index.js"),o=Object(i.Router)();o.post("/",function(){var r=s()(v.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p,m,h;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body,a=n.first_name,s=n.last_name,i=n.photo,u=n.address,o=n.country_code,c=n.phonenumber,l=n.gender,d=n.age_range,f=n.preferences,p=t.user.id,m=_.a.object().keys({first_name:_.a.string().required(),last_name:_.a.string().required(),photo:_.a.string().uri({allowRelative:!0}).allow("",null),address:_.a.string().allow("",null),country_code:_.a.string().max(3).required(),phonenumber:_.a.string().max(20).allow("",null),gender:_.a.number().min(0).max(1).required(),age_range:_.a.number().min(0).max(3).required(),preferences:_.a.string().allow("",null)}),e.prev=3,_.a.assert({first_name:a,last_name:s,photo:i,address:u,country_code:o,phonenumber:c,gender:l,age_range:d,preferences:f},m,{abortEarly:!1}),e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(3),h=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:h}));case 11:return e.prev=11,e.next=14,y.default.User.update({first_name:a,last_name:s,photo:i,address:u||"",country_code:o,phonenumber:c||"",gender:l,age_range:d,preferences:f||""},{where:{id:p}});case 14:r.status(200).send({data:{msg:"Success"}}),e.next=21;break;case 17:e.prev=17,e.t1=e.catch(11),b.default.error("Error on updating user:",e.t1),r.status(500).send({errors:[e.t1]});case 21:case"end":return e.stop()}},e,null,[[3,7],[11,17]])}));return function(e,t){return r.apply(this,arguments)}}()),t.default=o},"./src/router/front/reaction.js":
/*!**************************************!*\
  !*** ./src/router/front/reaction.js ***!
  \**************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),v=r.n(n),a=r(/*! @babel/runtime/helpers/defineProperty */"@babel/runtime/helpers/defineProperty"),s=r.n(a),i=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),u=r.n(i),o=r(/*! express */"express"),c=r(/*! @hapi/joi */"@hapi/joi"),_=r.n(c),y=r(/*! ../../model */"./src/model/index.js"),b=r(/*! ../../middleware/logger */"./src/middleware/logger/index.js"),g=r(/*! ../../middleware/graph */"./src/middleware/graph/index.js");function l(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function k(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach(function(e){s()(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var d=Object(o.Router)();d.post("/",function(){var r=u()(v.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p,m,h;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body,a=n.relation_id,s=n.type,i=n.value,u=t.user.id,o=_.a.object().keys({relation_id:_.a.number().required(),type:_.a.number().required(),value:_.a.number().min(1).required()}),e.prev=3,_.a.assert({relation_id:a,type:s,value:i},o,{abortEarly:!1}),e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(3),c=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:c}));case 11:return e.prev=11,e.next=14,y.default.Reaction.findOne({where:{relation_id:a,type:s,user_id:u}});case 14:if(l=e.sent)return i=l.value!=i?i:0,e.next=19,y.default.Reaction.update({value:i},{where:{id:l.id}});e.next=22;break;case 19:g.default.updateLike(k(k({},l.get({plain:!0})),{},{value:i})),e.next=26;break;case 22:return e.next=24,y.default.Reaction.create({relation_id:a,type:s,user_id:u,value:i});case 24:d=e.sent,g.default.addLike(d.get({plain:!0}));case 26:return f={},0==s&&(f=y.default.Event),e.next=30,f.findOne({nest:!0,raw:!1,include:[{model:y.default.Reaction,attributes:["user_id"],required:!1,where:{type:s,value:1},as:"likes"},{model:y.default.Reaction,attributes:["user_id"],required:!1,where:{type:s,value:2},as:"dislikes"}],where:{id:a}});case 30:p=e.sent,m=p.likes,h=p.dislikes,r.status(200).send({data:{value:i,type:s,relation_id:a,likes:m,dislikes:h}}),e.next=39;break;case 35:e.prev=35,e.t1=e.catch(11),b.default.error("Error on making reaction:",e.t1),r.status(500).send({errors:[e.t1]});case 39:case"end":return e.stop()}},e,null,[[3,7],[11,35]])}));return function(e,t){return r.apply(this,arguments)}}()),t.default=d},"./src/router/front/relation.js":
/*!**************************************!*\
  !*** ./src/router/front/relation.js ***!
  \**************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),p=r.n(n),a=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),s=r.n(a),i=r(/*! express */"express"),m=r(/*! ../../model */"./src/model/index.js"),h=r(/*! ../../middleware/logger */"./src/middleware/logger/index.js"),v=r(/*! ../../middleware/graph */"./src/middleware/graph/index.js"),_=r(/*! ../../middleware/notification */"./src/middleware/notification/index.js"),u=Object(i.Router)(),y=function(){var t=s()(p.a.mark(function e(t){var r,n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.default.Relation.findAll({nest:!0,raw:!1,where:{user_id:t},attributes:["createdAt","updatedAt"],include:[{model:m.default.User,as:"follower",attributes:["id","first_name","last_name","photo"]}]});case 2:return r=e.sent,e.next=5,m.default.Relation.findAll({nest:!0,raw:!1,where:{follower_id:t},attributes:["createdAt","updatedAt"],include:[{model:m.default.User,as:"user_info",attributes:["id","first_name","last_name","photo"]}]});case 5:return n=e.sent,e.abrupt("return",{followers:r,following:n});case 7:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}();u.get("/",function(){var r=s()(p.a.mark(function e(t,r){var n,a,s,i;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.user.id,e.prev=1,e.next=4,y(n);case 4:a=e.sent,s=a.followers,i=a.following,r.status(200).send({data:{followers:s,following:i}}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),h.default.error("Error on getting relation:",e.t0),r.status(500).send({errors:[e.t0]});case 13:case"end":return e.stop()}},e,null,[[1,9]])}));return function(e,t){return r.apply(this,arguments)}}()),u.post("/follow/:user_id",function(){var r=s()(p.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.user_id,a=t.user,s=a.id,i=a.first_name,u=a.last_name,e.prev=2,e.next=5,m.default.Relation.findOne({where:{user_id:parseInt(n,10),follower_id:s}});case 5:if(o=e.sent,c=0,o)return c=1,e.next=11,m.default.Relation.destroy({where:{id:o.id}});e.next=14;break;case 11:v.default.unfollowUser(o.get({plain:!0})),e.next=18;break;case 14:return e.next=16,m.default.Relation.create({user_id:parseInt(n,10),follower_id:s});case 16:o=e.sent,v.default.followUser(o.get({plain:!0}));case 18:return _.default.sendFollowNotification(n,"".concat(i," ").concat(u),c),e.next=21,y(s);case 21:l=e.sent,d=l.followers,f=l.following,r.status(200).send({data:{followers:d,following:f}}),e.next=30;break;case 26:e.prev=26,e.t0=e.catch(2),h.default.error("Error on following:",e.t0),r.status(500).send({errors:[e.t0]});case 30:case"end":return e.stop()}},e,null,[[2,26]])}));return function(e,t){return r.apply(this,arguments)}}()),t.default=u},"./src/router/front/ticket.js":
/*!************************************!*\
  !*** ./src/router/front/ticket.js ***!
  \************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),b=r.n(n),a=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),s=r.n(a),i=r(/*! express */"express"),g=r(/*! ../../model */"./src/model/index.js"),k=r(/*! ../../middleware/logger */"./src/middleware/logger/index.js"),u=r(/*! sequelize */"sequelize"),h=r.n(u),w=r(/*! ../../middleware/stripe */"./src/middleware/stripe.js"),x=r(/*! ../../config */"./src/config/index.js"),o=Object(i.Router)(),c=(h.a.Op,["id","event_id","user_id","amount","price","status","createdAt","updatedAt"]),l=[{model:g.default.Event,attributes:["id","title","start_date","end_date","location"],as:"eventinfo",required:!1,include:[{model:g.default.User,as:"creator",attributes:["id","first_name","last_name","photo"]}]},{model:g.default.User,as:"owner",attributes:["id","first_name","last_name","photo"]}];o.get("/",function(){var r=s()(b.a.mark(function e(t,r){var n,a;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.user.id,e.prev=1,e.next=4,g.default.Ticket.findAll({nest:!0,raw:!1,attributes:c,include:l,where:{status:0,user_id:n}});case 4:a=e.sent,r.status(200).send({data:a}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),k.default.error("Error on fetching tickets:",e.t0),r.status(500).send({errors:[e.t0]});case 12:case"end":return e.stop()}},e,null,[[1,8]])}));return function(e,t){return r.apply(this,arguments)}}()),o.post("/checkTicketLimit",function(){var r=s()(b.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p,m;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.user.id,a=t.body,s=a.event_id,i=a.amount,e.prev=2,e.next=5,g.default.Event.findByPk(s);case 5:return u=e.sent,o=u.total_ticket,c=u.ticket_limit,e.next=9,g.default.TicketPurchase.findAll({attributes:[[h.a.fn("sum",h.a.col("amount")),"total_amount"]],where:{event_id:s}});case 9:if(l=e.sent,(d=o-parseInt(l||0,10))<i)return e.abrupt("return",r.status(403).send({errors:[{message:d<=0?"No more tickets left on this event.":"".concat(d," tickets are remaining.")}]}));e.next=13;break;case 13:return e.next=15,g.default.TicketPurchase.findOne({where:{user_id:n,event_id:s}});case 15:if(f=e.sent,p=f?f.amount:0,c<p+i)return m=c-p,e.abrupt("return",r.status(403).send({errors:[{message:m<=0?"You can't buy any more tickets on this event.":"You can buy only ".concat(m," tickets.")}]}));e.next=20;break;case 20:r.status(200).send({data:{msg:"success"}}),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(2),k.default.error("Error on checking limit:",e.t0),r.status(500).send({errors:[e.t0]});case 27:case"end":return e.stop()}},e,null,[[2,23]])}));return function(e,t){return r.apply(this,arguments)}}()),o.post("/buyOnEvent",function(){var r=s()(b.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p,m,h,v,_,y;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.user,a=n.id,s=n.first_name,i=n.last_name,u=t.body,o=u.token,c=u.event_id,l=u.amount,e.prev=2,e.next=5,g.default.Event.findByPk(c);case 5:if(d=e.sent,f=d.price,p=d.user_id,m=d.title,0!==d.free_event){e.next=24;break}if(h=f*l*(100+x.default.service_fee),o)return e.next=12,w.default.createCharge(h,"usd",o);e.next=15;break;case 12:if(e.sent){e.next=15;break}return e.abrupt("return",r.status(403).send({errors:[{message:"There's a problem on checkout."}]}));case 15:return e.next=17,g.default.PaymentHistory.create({user_id:a,amount:(h/100).toFixed(2),type:1,related_user_id:p,description:"Buy ".concat(l," tickets on event - ").concat(m)});case 17:return e.next=19,g.default.PaymentHistory.create({user_id:p,amount:(f*l).toFixed(2),type:0,related_user_id:a,description:"User ".concat(s," ").concat(i," bought ").concat(l," tickets on event - ").concat(m)});case 19:return e.next=21,g.default.User.findByPk(p);case 21:return v=e.sent,e.next=24,g.default.User.update({cash:(v.cash+f*l).toFixed(2)},{where:{id:p}});case 24:return e.next=26,g.default.TicketPurchase.findOne({where:{user_id:a,event_id:c}});case 26:if(_=e.sent){e.next=32;break}return e.next=30,g.default.TicketPurchase.create({event_id:c,user_id:a,amount:l});case 30:e.next=34;break;case 32:return e.next=34,g.default.TicketPurchase.update({amount:_.amount+l},{where:{id:_.id}});case 34:return e.next=36,g.default.Ticket.findOne({where:{user_id:a,event_id:c}});case 36:if(y=e.sent){e.next=42;break}return e.next=40,g.default.Ticket.create({event_id:c,user_id:a,amount:l,price:f,status:0});case 40:e.next=44;break;case 42:return e.next=44,g.default.Ticket.update({amount:y.amount+l,price:f},{where:{id:y.id}});case 44:r.status(200).send({data:{}}),e.next=51;break;case 47:e.prev=47,e.t0=e.catch(2),k.default.error("Error on buying tickets:",e.t0),r.status(500).send({errors:[e.t0]});case 51:case"end":return e.stop()}},e,null,[[2,47]])}));return function(e,t){return r.apply(this,arguments)}}()),o.post("/sendToFriend",function(){var r=s()(b.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.user.id,a=t.body,s=a.ticket_id,i=a.amount,u=a.friend_id,e.prev=2,e.next=5,g.default.Ticket.findByPk(s);case 5:return o=e.sent,e.next=8,g.default.Market.findOne({where:{user_id:n,ticket_id:s}});case 8:if(c=e.sent,l=c?c.amount:0,(d=o.amount-l)<i)return e.abrupt("return",r.status(403).send({errors:[{message:"You can send only ".concat(d," tickets.")}]}));e.next=13;break;case 13:if(o.amount===i)return e.next=16,g.default.Ticket.destroy({where:{id:o.id}});e.next=18;break;case 16:e.next=20;break;case 18:return e.next=20,g.default.Ticket.update({amount:o.amount-i},{where:{id:o.id}});case 20:return e.next=22,g.default.Ticket.findOne({where:{id:s,user_id:u}});case 22:if(f=e.sent)return e.next=26,g.default.Ticket.update({amount:f.amount+i},{where:{id:f.id}});e.next=28;break;case 26:e.next=30;break;case 28:return e.next=30,g.default.Ticket.create({user_id:u,amount:i,price:o.price,event_id:o.event_id});case 30:r.status(200).send({data:{}}),e.next=37;break;case 33:e.prev=33,e.t0=e.catch(2),k.default.error("Error on sending to friend:",e.t0),r.status(500).send({errors:[e.t0]});case 37:case"end":return e.stop()}},e,null,[[2,33]])}));return function(e,t){return r.apply(this,arguments)}}()),o.post("/buyOnMarket",function(){var r=s()(b.a.mark(function e(t,r){var n,a,s,i,u,o,c,l,d,f,p,m,h,v,_;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.user,a=n.id,s=n.first_name,i=n.last_name,u=t.body,o=u.token,c=u.market_id,l=u.amount,e.prev=2,e.next=5,g.default.Market.findByPk(c);case 5:if(d=e.sent,l>d.amount)return e.abrupt("return",r.status(403).send({errors:[{message:"You can buy only ".concat(d.amount," tickets")}]}));e.next=8;break;case 8:return f=d.price,p=d.user_id,e.next=11,g.default.User.findByPk(p);case 11:if(m=e.sent,h=f*l*(100+x.default.service_fee),o)return e.next=16,w.default.createCharge(h,"usd",o);e.next=19;break;case 16:if(e.sent){e.next=19;break}return e.abrupt("return",r.status(403).send({errors:[{message:"There's a problem on checkout."}]}));case 19:return e.next=21,g.default.PaymentHistory.create({user_id:a,amount:(h/100).toFixed(2),type:1,related_user_id:p,description:"Buy ".concat(l," tickets on Market from ").concat(m.first_name," ").concat(m.last_name)});case 21:return e.next=23,g.default.PaymentHistory.create({user_id:p,amount:(f*l).toFixed(2),type:0,related_user_id:a,description:"User ".concat(s," ").concat(i," bought ").concat(l," tickets on Market")});case 23:return e.next=25,g.default.User.update({cash:(m.cash+f*l).toFixed(2)},{where:{id:p}});case 25:if(l===d.amount)return e.next=28,g.default.Market.destroy({where:{id:c}});e.next=30;break;case 28:e.next=32;break;case 30:return e.next=32,g.default.Market.update({amount:d.amount-l},{where:{id:c}});case 32:return e.next=34,g.default.Ticket.findOne({where:{id:d.ticket_id}});case 34:if(v=e.sent,l===v.amount)return e.next=38,g.default.Ticket.destroy({where:{id:v.id}});e.next=40;break;case 38:e.next=42;break;case 40:return e.next=42,g.default.Market.update({amount:v.amount-l},{where:{id:d.ticket_id}});case 42:return e.next=44,g.default.Ticket.findOne({where:{user_id:a,event_id:v.event_id}});case 44:if(_=e.sent){e.next=50;break}return e.next=48,g.default.Ticket.create({event_id:v.event_id,user_id:a,amount:l,price:f,status:0});case 48:e.next=52;break;case 50:return e.next=52,g.default.Ticket.update({amount:_.amount+l,price:f},{where:{id:_.id}});case 52:r.status(200).send({data:{}}),e.next=59;break;case 55:e.prev=55,e.t0=e.catch(2),k.default.error("Error on buying tickets:",e.t0),r.status(500).send({errors:[e.t0]});case 59:case"end":return e.stop()}},e,null,[[2,55]])}));return function(e,t){return r.apply(this,arguments)}}()),o.post("/delete/:ticket_id",function(){var r=s()(b.a.mark(function e(t,r){var n,a;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.user.id,a=t.params.ticket_id,e.prev=2,e.next=5,g.default.Ticket.destroy({where:{id:a}});case 5:return e.next=7,g.default.Market.destroy({where:{user_id:n,ticket_id:a}});case 7:r.status(200).send({data:{msg:"success"}}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),k.default.error("Error on deleting market:",e.t0),r.status(500).send({errors:[e.t0]});case 14:case"end":return e.stop()}},e,null,[[2,10]])}));return function(e,t){return r.apply(this,arguments)}}()),t.default=o},"./src/router/front/user.js":
/*!**********************************!*\
  !*** ./src/router/front/user.js ***!
  \**********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),s=r.n(n),a=r(/*! @babel/runtime/helpers/defineProperty */"@babel/runtime/helpers/defineProperty"),i=r.n(a),u=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),o=r.n(u),c=r(/*! express */"express"),l=r(/*! passport */"passport"),d=r.n(l),f=(r(/*! @hapi/joi */"@hapi/joi"),r(/*! ../../model */"./src/model/index.js")),p=(r(/*! ../../middleware/graph */"./src/middleware/graph/index.js"),r(/*! ../../middleware/logger */"./src/middleware/logger/index.js")),m=r(/*! sequelize */"sequelize"),h=r.n(m),v=Object(c.Router)(),_=h.a.Op,y=["id","first_name","last_name","photo"],b=[{model:f.default.Relation,as:"followers",attributes:["user_id"]}];v.post("/search",d.a.authenticate("jwt",{failWithError:!0,session:!1}),function(){var r=o()(s.a.mark(function e(t,r){var n,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.body.search_string,e.next=4,f.default.User.findAll({nest:!0,raw:!1,attributes:y,include:b,where:h.a.where(h.a.fn("concat",h.a.col("first_name"),h.a.col("last_name")),i()({},_.iLike,"%".concat(n,"%")))});case 4:a=e.sent,r.status(200).send({data:a}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),p.default.error("Error on fetching users:",e.t0),r.status(500).send({errors:[e.t0]});case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(e,t){return r.apply(this,arguments)}}()),t.default=v},"./src/router/index.js":
/*!*****************************!*\
  !*** ./src/router/index.js ***!
  \*****************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! ./public */"./src/router/public/index.js"),a=r(/*! ./front */"./src/router/front/index.js"),s=(r(/*! ./admin */"./src/router/admin/index.js"),r(/*! ../config */"./src/config/index.js")),i=r(/*! ../middleware/logger */"./src/middleware/logger/index.js");t.default=function(e){Object(n.default)(e),Object(a.default)(e),e.use(function(e,t,r){var n=new Error("Not Found");n.status=404,r(n)}),e.use(function(e,t,r,n){i.default.error("API response error:",e),r.status(e.status||500),r.json({errors:["development"==s.default.env_mode?e:{message:e.message||"Internal Server Error"}]})})}},"./src/router/public/index.js":
/*!************************************!*\
  !*** ./src/router/public/index.js ***!
  \************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! ./media */"./src/router/public/media.js");t.default=function(e){e.use("/media",n.default)}},"./src/router/public/media.js":
/*!************************************!*\
  !*** ./src/router/public/media.js ***!
  \************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! @babel/runtime/regenerator */"@babel/runtime/regenerator"),c=r.n(n),a=r(/*! @babel/runtime/helpers/asyncToGenerator */"@babel/runtime/helpers/asyncToGenerator"),s=r.n(a),i=r(/*! express */"express"),u=r(/*! @hapi/joi */"@hapi/joi"),l=r.n(u),d=r(/*! ../../middleware/logger */"./src/middleware/logger/index.js"),o=r(/*! express-formidable */"express-formidable"),f=r.n(o),p=r(/*! ../../middleware/uploader */"./src/middleware/uploader/index.js"),m=Object(i.Router)();m.post("/upload",f()(),function(){var r=s()(c.a.mark(function e(t,r){var n,a,s,i;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.files.file,a=l.a.object().keys({file:l.a.any().meta({swaggerType:"file"}).required()}),e.prev=2,l.a.assert({file:n},a,{abortEarly:!1}),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),s=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:s}));case 10:return e.prev=10,e.next=13,p.default.uploadFile(n);case 13:i=e.sent,r.status(200).send({data:{url:i.Location}}),e.next=21;break;case 17:e.prev=17,e.t1=e.catch(10),d.default.error("Error on uploading file:",e.t1),r.status(500).send({errors:[e.t1]});case 21:case"end":return e.stop()}},e,null,[[2,6],[10,17]])}));return function(e,t){return r.apply(this,arguments)}}()),m.post("/upload_base64",function(){var r=s()(c.a.mark(function e(t,r){var n,a,s,i,u,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.body,a=n.uri,s=n.name,i=l.a.object().keys({uri:l.a.string().required(),name:l.a.string().required()}),e.prev=2,l.a.assert({uri:a,name:s},i,{abortEarly:!1}),e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(2),u=e.t0.details.map(function(e){return{message:e.message}}),e.abrupt("return",r.status(403).send({errors:u}));case 10:return e.prev=10,e.next=13,p.default.upload64({uri:a,name:s});case 13:o=e.sent,r.status(200).send({data:{url:o.Location}}),e.next=21;break;case 17:e.prev=17,e.t1=e.catch(10),d.default.error("Error on uploading file:",e.t1),r.status(500).send({errors:[e.t1]});case 21:case"end":return e.stop()}},e,null,[[2,6],[10,17]])}));return function(e,t){return r.apply(this,arguments)}}()),t.default=m},"./src/utils.js":
/*!**********************!*\
  !*** ./src/utils.js ***!
  \**********************/
/*! exports provided: generateCode */function(e,t,r){"use strict";r.r(t),r.d(t,"generateCode",function(){return n});var n=function(e){var t=e<=1?1:Math.pow(10,e-1);return Math.floor(t+9*Math.random()*t)}},0:
/*!********************!*\
  !*** multi ./src/ ***!
  \********************/
/*! no static exports found */function(e,t,r){e.exports=r(/*! ./src/ */"./src/index.js")},"@babel/runtime/helpers/asyncToGenerator":
/*!**********************************************************!*\
  !*** external "@babel/runtime/helpers/asyncToGenerator" ***!
  \**********************************************************/
/*! no static exports found */function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},"@babel/runtime/helpers/classCallCheck":
/*!********************************************************!*\
  !*** external "@babel/runtime/helpers/classCallCheck" ***!
  \********************************************************/
/*! no static exports found */function(e,t){e.exports=require("@babel/runtime/helpers/classCallCheck")},"@babel/runtime/helpers/createClass":
/*!*****************************************************!*\
  !*** external "@babel/runtime/helpers/createClass" ***!
  \*****************************************************/
/*! no static exports found */function(e,t){e.exports=require("@babel/runtime/helpers/createClass")},"@babel/runtime/helpers/defineProperty":
/*!********************************************************!*\
  !*** external "@babel/runtime/helpers/defineProperty" ***!
  \********************************************************/
/*! no static exports found */function(e,t){e.exports=require("@babel/runtime/helpers/defineProperty")},"@babel/runtime/helpers/get":
/*!*********************************************!*\
  !*** external "@babel/runtime/helpers/get" ***!
  \*********************************************/
/*! no static exports found */function(e,t){e.exports=require("@babel/runtime/helpers/get")},"@babel/runtime/helpers/getPrototypeOf":
/*!********************************************************!*\
  !*** external "@babel/runtime/helpers/getPrototypeOf" ***!
  \********************************************************/
/*! no static exports found */function(e,t){e.exports=require("@babel/runtime/helpers/getPrototypeOf")},"@babel/runtime/helpers/inherits":
/*!**************************************************!*\
  !*** external "@babel/runtime/helpers/inherits" ***!
  \**************************************************/
/*! no static exports found */function(e,t){e.exports=require("@babel/runtime/helpers/inherits")},"@babel/runtime/helpers/possibleConstructorReturn":
/*!*******************************************************************!*\
  !*** external "@babel/runtime/helpers/possibleConstructorReturn" ***!
  \*******************************************************************/
/*! no static exports found */function(e,t){e.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},"@babel/runtime/helpers/typeof":
/*!************************************************!*\
  !*** external "@babel/runtime/helpers/typeof" ***!
  \************************************************/
/*! no static exports found */function(e,t){e.exports=require("@babel/runtime/helpers/typeof")},"@babel/runtime/regenerator":
/*!*********************************************!*\
  !*** external "@babel/runtime/regenerator" ***!
  \*********************************************/
/*! no static exports found */function(e,t){e.exports=require("@babel/runtime/regenerator")},"@hapi/joi":
/*!****************************!*\
  !*** external "@hapi/joi" ***!
  \****************************/
/*! no static exports found */function(e,t){e.exports=require("@hapi/joi")},"aws-sdk":
/*!**************************!*\
  !*** external "aws-sdk" ***!
  \**************************/
/*! no static exports found */function(e,t){e.exports=require("aws-sdk")},bcryptjs:
/*!***************************!*\
  !*** external "bcryptjs" ***!
  \***************************/
/*! no static exports found */function(e,t){e.exports=require("bcryptjs")},"body-parser":
/*!******************************!*\
  !*** external "body-parser" ***!
  \******************************/
/*! no static exports found */function(e,t){e.exports=require("body-parser")},cors:
/*!***********************!*\
  !*** external "cors" ***!
  \***********************/
/*! no static exports found */function(e,t){e.exports=require("cors")},dotenv:
/*!*************************!*\
  !*** external "dotenv" ***!
  \*************************/
/*! no static exports found */function(e,t){e.exports=require("dotenv")},express:
/*!**************************!*\
  !*** external "express" ***!
  \**************************/
/*! no static exports found */function(e,t){e.exports=require("express")},"express-formidable":
/*!*************************************!*\
  !*** external "express-formidable" ***!
  \*************************************/
/*! no static exports found */function(e,t){e.exports=require("express-formidable")},"firebase-admin":
/*!*********************************!*\
  !*** external "firebase-admin" ***!
  \*********************************/
/*! no static exports found */function(e,t){e.exports=require("firebase-admin")},fs:
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/*! no static exports found */function(e,t){e.exports=require("fs")},handlebars:
/*!*****************************!*\
  !*** external "handlebars" ***!
  \*****************************/
/*! no static exports found */function(e,t){e.exports=require("handlebars")},helmet:
/*!*************************!*\
  !*** external "helmet" ***!
  \*************************/
/*! no static exports found */function(e,t){e.exports=require("helmet")},http:
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/*! no static exports found */function(e,t){e.exports=require("http")},jsonwebtoken:
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/*! no static exports found */function(e,t){e.exports=require("jsonwebtoken")},lodash:
/*!*************************!*\
  !*** external "lodash" ***!
  \*************************/
/*! no static exports found */function(e,t){e.exports=require("lodash")},moment:
/*!*************************!*\
  !*** external "moment" ***!
  \*************************/
/*! no static exports found */function(e,t){e.exports=require("moment")},nodemailer:
/*!*****************************!*\
  !*** external "nodemailer" ***!
  \*****************************/
/*! no static exports found */function(e,t){e.exports=require("nodemailer")},passport:
/*!***************************!*\
  !*** external "passport" ***!
  \***************************/
/*! no static exports found */function(e,t){e.exports=require("passport")},"passport-jwt":
/*!*******************************!*\
  !*** external "passport-jwt" ***!
  \*******************************/
/*! no static exports found */function(e,t){e.exports=require("passport-jwt")},"passport-local":
/*!*********************************!*\
  !*** external "passport-local" ***!
  \*********************************/
/*! no static exports found */function(e,t){e.exports=require("passport-local")},path:
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/*! no static exports found */function(e,t){e.exports=require("path")},qrcode:
/*!*************************!*\
  !*** external "qrcode" ***!
  \*************************/
/*! no static exports found */function(e,t){e.exports=require("qrcode")},sequelize:
/*!****************************!*\
  !*** external "sequelize" ***!
  \****************************/
/*! no static exports found */function(e,t){e.exports=require("sequelize")},stripe:
/*!*************************!*\
  !*** external "stripe" ***!
  \*************************/
/*! no static exports found */function(e,t){e.exports=require("stripe")},uuid:
/*!***********************!*\
  !*** external "uuid" ***!
  \***********************/
/*! no static exports found */function(e,t){e.exports=require("uuid")},winston:
/*!**************************!*\
  !*** external "winston" ***!
  \**************************/
/*! no static exports found */function(e,t){e.exports=require("winston")},"winston-daily-rotate-file":
/*!********************************************!*\
  !*** external "winston-daily-rotate-file" ***!
  \********************************************/
/*! no static exports found */function(e,t){e.exports=require("winston-daily-rotate-file")},zlib:
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/*! no static exports found */function(e,t){e.exports=require("zlib")}});